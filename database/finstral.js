// ============================================================================
// LISTINO FINSTRAL INFISSI - EUR 2025/10 - v8.509
// ============================================================================
// 
// ğŸ†• v8.509 (11 FEB 2026): CALCOLO BRM CON FALLBACK + HELPER TWIN
// - Aggiunta funzione `getBRMConFallback()` centralizzata
// - Se BRM_L/BRM_H sono null â†’ calcola automaticamente da misure vano
// - REGOLA FALLBACK (prioritÃ ): BRM â†’ LF/HF (+100/+50) â†’ LVT/HVT (+100/+50) â†’ TMV/HMT (-40/-20)
// - Applicato in `calcolaPrezzoFinstral()` â†’ Twin ora funziona anche con BRM null
// - Fix: Dashboard calcola preventivi anche con BRM non compilati
// - âœ… UNICA FUNZIONE DA MODIFICARE: `getBRMConFallback()` per aggiornare logica ovunque
// - ğŸ†• Aggiunti helper Twin: `getTwinModelDescription()` e `getTwinModelKey()`
//   - Conversione chiave interna â†” descrizione completa (es. "SLIM_TWIN" â†” "C788 - Slim-line Twin 77mm")
//   - Dashboard deve usare `getTwinModelDescription(key)` per visualizzare
//   - Calcoli usano chiave interna, visualizzazione usa descrizione
//
// ğŸ†• v8.508 (11 FEB 2026): FIX FATTORE TIPO 101 â†’ 1.0
// 
// IMPORTANTE - I supplementi telaio e anta ora distinguono GRUPPO COLORE:
// - Gruppo A = tonalitÃ  bianco (01, 42, 45, 07, 27) â†’ usa pvcA/aluA
// - Gruppo B = colori scuri (06, 13, 19, 55, 36, 46) â†’ usa pvcB/aluB
//
// STRUTTURA SUPPLEMENTI TELAIO (â‚¬/ml perimetro telaio):
//   { pvcA, pvcB, aluA, aluB }
//   - pvcA/pvcB = supplemento profilo PVC interno
//   - aluA/aluB = supplemento rivestimento alluminio esterno
//
// STRUTTURA SUPPLEMENTI ANTA (â‚¬/ml perimetro anta):
//   { pvcA, pvcB, aluA, aluB }
//   - pvcA/pvcB = supplemento profilo PVC anta
//   - aluA/aluB = supplemento rivestimento alluminio anta
//
// ESEMPIO CALCOLO (colore 13 castagno = gruppo B):
//   Telaio 965: pvcB(13.1) + aluB(17.3) = 30.4 â‚¬/ml Ã— perimetro
//   Anta Classic-line: pvcB(6.35) + aluB(11.6) = 17.95 â‚¬/ml Ã— perimetro ante
//
// ============================================================================

window.FINSTRAL_PREZZI = {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… v8.465: FATTORI VERIFICATI SU 9 POSIZIONI ORDINE RUGGERI
    // Le tabelle base sono EUR 2025/3, applico fattore correzione
    // 
    // FATTORI CALCOLATI DA CONFERME ORDINE REALI:
    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ Tipo         â”‚ Altezza    â”‚ Fattore â”‚ Verifica              â”‚
    // â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    // â”‚ 102 (fisso)  â”‚ qualsiasi  â”‚ 1.336   â”‚ Pos.8 Alberto Papa    â”‚
    // â”‚ 101          â”‚ H<=1600    â”‚ 1.2075  â”‚ (stimato)             â”‚
    // â”‚ 101          â”‚ H>2200     â”‚ 1.27    â”‚ Pos.2,6 Ruggeri       â”‚
    // â”‚ 401          â”‚ H<=1600    â”‚ 1.2075  â”‚ Pos.5,8 Ruggeri       â”‚
    // â”‚ 401          â”‚ H>2200     â”‚ 1.22    â”‚ Pos.1 Ruggeri         â”‚
    // â”‚ 420/421      â”‚ H<=1600    â”‚ 1.21    â”‚ Pos.3,4,7,9 Ruggeri   â”‚
    // â”‚ 420/421      â”‚ H>2200     â”‚ 1.22    â”‚ (stimato)             â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    // Errore medio atteso: <2%
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    versione: "EUR 2025/10 v8.505",
    dataAggiornamento: "2026-01-27",
    note: "Supplementi telaio e anta verificati da listino PDF",
    // âœ… v8.465: Funzione fattore correzione VERIFICATA
    getFattoreCorrezione: function(altezza, tipo = null) {
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.484: TUTTI I TIPI CON PREZZI EUR 2025/10 â†’ FATTORE 1.0!
// I prezzi nelle tabelle sono giÃ  quelli del listino EUR 2025/10
// NON applicare nessun fattore di correzione!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// TIPO 102 (FISSO): prezzi EUR 2025/10 diretti
if (tipo === "102") {
    return 1.0;  // âœ… v8.484: Prezzi giÃ  corretti EUR 2025/10
}

// TIPO 401 (2 ante montante mobile): prezzi EUR 2025/10 diretti
if (tipo === "401") {
    return 1.0;  // âœ… v8.482: Prezzi giÃ  corretti EUR 2025/10
}

// TIPO 420/421 (compositi): fattore leggermente diverso
if (tipo === "420" || tipo === "421") {
    return altezza > 2200 ? 1.22 : 1.21;
}

// TIPO 101 (1 anta): prezzi EUR 2025/10 diretti
if (tipo === "101") {
    return 1.0;  // âœ… v8.508: Fattore corretto
}

// Altri tipi (default)
if (altezza <= 1600) return 1.2075;
if (altezza <= 2200) return 1.22;
return 1.22;
    },
    fattoreCorrezione: 1.2075,  // Default per retrocompatibilitÃ 
    
    // TABELLE PREZZI BASE - Tipo 101 (1 anta anta/ribalta)
    tipo101: {
descrizione: "Finestra 1 anta (anta/ribalta)",
colonneL: [615, 675, 740, 800, 865, 925, 990, 1050, 1115, 1175, 1240, 1300, 1365, 1425, 1490, 1550, 1615, 1675, 1740, 1800, 1865, 1925, 1990, 2050, 2115, 2175, 2240, 2300, 2365, 2425, 2490, 2550, 2615, 2675, 2740],
righeA: [605, 665, 730, 790, 855, 915, 980, 1040, 1105, 1165, 1230, 1290, 1355, 1415, 1480, 1540, 1605, 1665, 1730, 1790, 1855, 1915, 1980, 2040, 2105, 2165, 2230, 2290, 2355, 2415, 2480, 2540, 2605, 2665, 2730, 2790, 2855, 2915, 2980],
prezzi: [
    [221, 231, 237, 248, 258, 266, 287, 294, 300, 311, 317, 329, 340, 351, 362, 367, 378, 392, 403, 408, 415, 422, 436, 445, 460, 467, 478, 487, 496, 504, 511, 519, 528, 537, 545],
    [229, 237, 243, 261, 267, 275, 295, 301, 311, 323, 329, 341, 354, 364, 371, 379, 395, 405, 415, 421, 432, 438, 449, 464, 477, 485, 492, 499, 506, 520, 530, 538, 546, 557, 567],
    [235, 243, 257, 267, 276, 284, 308, 314, 327, 333, 343, 354, 366, 375, 382, 396, 408, 420, 427, 438, 447, 456, 471, 484, 498, 504, 512, 520, 528, 538, 544, 557, 568, 574, 584],
    [248, 261, 269, 277, 288, 296, 314, 329, 337, 351, 363, 370, 380, 395, 405, 412, 424, 437, 448, 458, 467, 477, 493, 504, 515, 526, 537, 544, 557, 569, 580, 588, 598, 610, 618],
    [259, 268, 277, 287, 297, 307, 328, 341, 352, 364, 374, 382, 396, 409, 417, 425, 441, 451, 466, 473, 486, 498, 511, 522, 537, 544, 556, 569, 577, 588, 599, 611, 619, 627, 640],
    [272, 283, 289, 302, 316, 320, 350, 363, 370, 380, 393, 404, 417, 428, 440, 449, 465, 477, 490, 500, 511, 519, 537, 548, 565, 574, 585, 597, 611, 621, 634, 646, 659, 672, 683],
    [285, 297, 308, 321, 335, 337, 368, 379, 392, 404, 412, 424, 437, 450, 464, 472, 491, 504, 514, 526, 537, 549, 565, 575, 588, 599, 611, 620, 630, 644, 653, 665, 675, 686, 693],
    [295, 307, 319, 332, 349, 352, 378, 394, 405, 414, 424, 440, 450, 464, 474, 487, 504, 516, 530, 541, 554, 568, 582, 593, 611, 618, 627, 638, 647, 658, 667, 676, 685, 692, 702],
    [299, 311, 324, 337, 352, 365, 392, 405, 414, 428, 440, 451, 465, 478, 493, 505, 518, 535, 549, 564, 575, 585, 600, 613, 626, 639, 650, 662, 674, 683, 692, 704, 713, 726, 736],
    [308, 321, 333, 347, 364, 374, 402, 414, 427, 440, 450, 466, 478, 493, 507, 516, 535, 550, 568, 577, 588, 600, 617, 627, 648, 660, 673, 682, 691, 703, 712, 725, 735, 747, 756],
    [320, 334, 347, 364, 376, 388, 416, 430, 443, 457, 469, 484, 498, 511, 523, 539, 556, 574, 586, 597, 613, 622, 637, 655, 674, 687, 700, 712, 727, 741, 754, 769, 785, 798, 813],
    [328, 342, 361, 370, 384, 397, 425, 441, 451, 469, 482, 498, 511, 525, 539, 551, 572, 586, 601, 614, 626, 638, 660, 674, 691, 703, 717, 728, 740, 753, 768, 778, 802, 815, 829],
    [337, 354, 367, 380, 398, 411, 438, 451, 469, 482, 497, 511, 525, 541, 553, 570, 587, 601, 625, 637, 654, 667, 687, 699, 718, 730, 742, 754, 768, 782, 795, 805, 818, 831, 843],
    [350, 365, 375, 393, 409, 422, 450, 465, 480, 497, 511, 525, 541, 556, 572, 585, 602, 618, 639, 655, 674, 687, 704, 717, 734, 754, 775, 797, 817, 837, 855, 879, 897, 917, 937],
    [361, 371, 382, 404, 418, 433, 464, 478, 497, 511, 523, 540, 554, 572, 586, 598, 619, 634, 660, 675, 689, 708, 726, 740, 758, 783, 804, 828, 850, 875, 895, 920, 935, 957, 980],
    [368, 380, 397, 414, 431, 447, 477, 495, 507, 523, 539, 554, 572, 586, 599, 615, 634, 655, 678, 692, 706, 721, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [376, 395, 408, 423, 445, 457, 490, 505, 518, 539, 553, 573, 586, 601, 615, 628, 653, 677, 692, 709, 725, 741, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [382, 403, 416, 434, 450, 469, 502, 514, 530, 548, 567, 584, 597, 615, 627, 646, 675, 693, 708, 731, 745, 764, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [415, 433, 447, 466, 485, 503, 533, 550, 569, 584, 599, 618, 631, 654, 673, 688, 706, 725, 745, 762, 784, 801, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [422, 443, 456, 474, 496, 511, 542, 562, 581, 595, 612, 653, 670, 696, 714, 728, 747, 767, 789, 807, 827, 847, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [433, 451, 467, 487, 507, 526, 557, 578, 593, 611, 623, 662, 685, 701, 720, 735, 758, 774, 800, 817, 851, 886, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [437, 461, 482, 503, 525, 542, 577, 595, 612, 625, 647, 669, 687, 706, 725, 747, 768, 789, 808, 829, 893, 953, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [446, 469, 492, 512, 536, 549, 586, 606, 622, 644, 660, 678, 692, 716, 738, 759, 781, 801, 822, 842, 908, 974, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [463, 482, 503, 523, 543, 564, 596, 615, 636, 653, 675, 690, 707, 730, 752, 771, 793, 816, 838, 859, 926, 992, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [471, 493, 515, 536, 560, 581, 611, 630, 652, 674, 686, 700, 718, 739, 767, 784, 803, 822, 852, 876, 942, 1010, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [484, 505, 525, 544, 571, 590, 622, 647, 667, 685, 699, 710, 727, 749, 782, 797, 816, 835, 865, 892, 960, 1028, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [489, 511, 535, 557, 581, 598, 634, 660, 679, 698, 709, 721, 738, 762, 796, 809, 828, 844, 881, 905, 974, 1040, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [495, 518, 542, 568, 592, 610, 648, 668, 687, 707, 722, 734, 748, 774, 809, 820, 840, 856, 896, 920, 992, 1061, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [507, 531, 552, 579, 599, 621, 660, 681, 698, 721, 734, 747, 764, 789, 824, 833, 850, 868, 909, 937, 1008, 1082, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [513, 537, 565, 587, 611, 631, 670, 704, 741, 778, 793, 805, 824, 847, 859, 881, 898, 915, 934, 951, 1015, 1079, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [515, 541, 571, 598, 618, 643, 680, 716, 752, 790, 803, 817, 835, 856, 872, 892, 908, 929, 946, 964, 1026, 1088, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [518, 548, 580, 610, 625, 652, 688, 727, 761, 801, 815, 830, 847, 868, 899, 929, 945, 963, 966, 981, 1037, 1093, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [529, 559, 587, 619, 636, 664, 700, 736, 774, 814, 828, 839, 857, 884, 924, 958, 976, 994, 986, 993, 1043, 1096, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [533, 566, 596, 628, 665, 694, 727, 758, 794, 833, 847, 861, 870, 898, 946, 989, 1004, 1026, 1003, 1005, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [539, 573, 607, 640, 675, 709, 741, 778, 812, 851, 868, 883, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [541, 580, 613, 650, 694, 733, 768, 800, 833, 872, 888, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [543, 583, 621, 661, 715, 755, 791, 825, 856, 891, 904, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [552, 592, 631, 672, 734, 782, 815, 849, 884, 917, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null],
    [560, 599, 640, 682, 752, 797, 830, 876, 907, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null]
]
    },

    // TABELLA PREZZI BASE - Tipo 102 (Elemento fisso)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ†• v8.484: TIPO 102 (FISSO) - PREZZI EUR 2025/10 DIRETTI (NO FATTORE!)
    // Fonte: Listino Finstral EUR 2025/10 pag. 164
    // âš ï¸ REGOLA: Usare SEMPRE prezzi EUR 2025/10 direttamente, fattore = 1.0
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    tipo102: {
descrizione: "Elemento fisso",
colonneL: [365, 490, 615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740, 2865, 2990, 3115],
righeA: [355, 415, 480, 540, 605, 665, 730, 790, 855, 915, 980, 1040, 1105, 1165, 1230, 1355, 1480, 1605, 1730, 1855, 1980, 2105, 2230, 2355, 2480, 2605, 2730, 2855, 2980],
prezzi: [
    // H=355 - EUR 2025/10
    [172, 181, 185, 194, 204, 212, 220, 228, 237, 244, 251, 262, 269, 277, 288, 298, 308, 318, 328, 339, 349, 358, 371],
    // H=415
    [175, 183, 192, 198, 209, 218, 224, 234, 243, 250, 262, 272, 283, 294, 305, 315, 327, 337, 349, 359, 372, 383, 395],
    // H=480
    [181, 186, 195, 203, 213, 222, 232, 240, 249, 264, 275, 288, 300, 312, 322, 335, 348, 359, 373, 385, 397, 409, 420],
    // H=540
    [183, 192, 199, 206, 220, 226, 235, 248, 264, 275, 289, 302, 315, 327, 340, 354, 366, 381, 395, 405, 418, 431, 444],
    // H=605
    [186, 195, 204, 211, 223, 233, 247, 263, 275, 289, 303, 317, 332, 345, 358, 375, 388, 403, 415, 428, 443, 456, 473],
    // H=665
    [190, 199, 206, 216, 228, 242, 256, 273, 289, 302, 316, 333, 345, 362, 377, 392, 406, 420, 437, 450, 467, 481, 496],
    // H=730
    [194, 203, 211, 221, 235, 251, 268, 286, 299, 315, 332, 346, 363, 379, 397, 410, 426, 443, 457, 475, 492, 508, 522],
    // H=790
    [198, 206, 216, 224, 245, 263, 278, 295, 313, 328, 345, 361, 379, 397, 412, 428, 446, 461, 480, 497, 513, 529, 547],
    // H=855
    [204, 215, 223, 235, 256, 275, 294, 312, 328, 345, 363, 381, 401, 418, 436, 452, 471, 490, 507, 523, 541, 560, 579],
    // H=915
    [208, 218, 228, 244, 266, 287, 303, 321, 341, 358, 378, 399, 415, 434, 452, 472, 492, 510, 527, 546, 564, 584, 604],
    // H=980
    [212, 222, 233, 251, 275, 295, 314, 334, 354, 375, 392, 412, 430, 452, 472, 493, 511, 532, 550, 570, 591, 609, 630],
    // H=1040
    [217, 224, 240, 259, 285, 304, 325, 344, 366, 388, 408, 427, 449, 470, 492, 511, 529, 551, 571, 593, 613, 634, 653],
    // H=1105 - VERIFICA: L=1615 â†’ â‚¬423
    [219, 231, 246, 268, 294, 314, 336, 357, 379, 401, 423, 443, 465, 489, 509, 529, 551, 573, 595, 617, 638, 659, 680],
    // H=1165
    [223, 234, 253, 276, 301, 323, 346, 370, 392, 413, 436, 457, 481, 503, 525, 547, 570, 594, 616, 638, 660, 682, 706],
    // H=1230
    [226, 239, 262, 286, 312, 334, 357, 381, 405, 427, 451, 475, 499, 522, 544, 568, 594, 616, 639, 661, 687, 709, 731],
    // H=1355
    [235, 250, 275, 300, 328, 353, 379, 405, 429, 454, 481, 506, 530, 556, 583, 608, 632, 658, 682, 709, 732, 759, 784],
    // H=1480
    [243, 264, 290, 315, 345, 375, 401, 428, 454, 482, 510, 537, 563, 592, 618, 646, 674, 701, 727, 754, 783, 811, 836],
    // H=1605
    [250, 274, 303, 332, 363, 393, 422, 451, 481, 510, 538, 567, 597, 626, 653, 685, 714, 744, 771, 801, 829, 859, 888],
    // H=1730
    [261, 287, 316, 346, 383, 412, 443, 475, 505, 537, 567, 599, 630, 660, 693, 722, 754, 785, 817, 847, 878, 911, 939],
    // H=1855
    [268, 299, 330, 363, 400, 431, 465, 499, 530, 564, 597, 630, 662, 697, 728, 761, 797, 827, 859, 894, 925, 957, 991],
    // H=1980
    [276, 312, 344, 379, 416, 451, 486, 521, 554, 591, 626, 660, 697, 731, 766, 801, 836, 869, 906, 938, 974, 1009, 1043],
    // H=2105
    [287, 321, 357, 397, 434, 472, 509, 544, 583, 618, 654, 692, 728, 766, 802, 838, 873, 912, 949, 985, 1022, 1059, 1095],
    // H=2230
    [296, 334, 374, 411, 451, 493, 529, 568, 607, 646, 685, 722, 759, 801, 838, 874, 915, 955, 992, 1031, 1071, 1108, 1146],
    // H=2355
    [308, 347, 388, 427, 471, 512, 551, 592, 632, 673, 713, 754, 796, 836, 873, 915, 956, 997, 1037, 1076, 1118, 1158, 1200],
    // H=2480
    [317, 357, 400, 444, 489, 529, 573, 616, 657, 702, 743, 785, 827, 869, 912, 955, 997, 1038, 1080, 1124, 1165, 1211, 1251],
    // H=2605
    [327, 372, 414, 456, 505, 550, 595, 638, 683, 726, 771, 817, 859, 906, 948, 992, 1035, 1080, null, null, null, null, null],
    // H=2730
    [337, 384, 427, 473, 522, 569, 616, 660, 708, 754, 801, 846, 894, 938, 984, 1031, 1076, 1123, null, null, null, null, null],
    // H=2855
    [347, 397, 443, 490, 541, 590, 636, 686, 733, 779, 828, 878, 925, 974, 1022, 1070, 1118, 1165, null, null, null, null, null],
    // H=2980
    [357, 406, 455, 506, 559, 608, 658, 709, 757, 809, 858, 910, 958, 1009, 1059, 1108, 1157, 1210, null, null, null, null, null]
]
    },

    // TABELLA PREZZI BASE - Tipo 401 (2 ante con montante mobile)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ†• v8.482: TIPO 401 - PREZZI EUR 2025/10 DIRETTI (NO FATTORE!)
    // Fonte: Listino Finstral EUR 2025/10 pag. 162-163
    // âš ï¸ REGOLA: Usare SEMPRE prezzi EUR 2025/10 direttamente, fattore = 1.0
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    tipo401: {
descrizione: "2 ante con montante mobile",
colonneL: [990, 1050, 1115, 1175, 1240, 1300, 1365, 1425, 1490, 1550, 1615, 1675, 1740, 1800, 1865, 1925, 1990, 2050, 2115, 2175, 2240, 2300, 2365, 2425, 2490, 2550, 2615],
// âœ… v8.482: Corretto 1490â†’1480 come da listino EUR 2025/10
righeA: [605, 665, 730, 790, 855, 915, 980, 1040, 1105, 1165, 1230, 1290, 1355, 1415, 1480, 1540, 1605, 1665, 1730, 1790, 1855, 1915, 1980, 2040, 2105, 2165, 2230, 2290, 2355, 2415, 2480, 2540, 2605, 2665, 2730, 2790],
prezzi: [
    // H=605
    [386, 395, 401, 408, 416, 424, 432, 441, 450, 467, 474, 482, 492, 497, 506, 512, 519, 526, 534, 542, 550, 555, 564, 571, 581, 589, 595],
    // H=665
    [400, 406, 415, 420, 426, 441, 449, 459, 466, 485, 496, 507, 516, 525, 534, 547, 556, 569, 580, 589, 596, 606, 613, 622, 631, 640, 650],
    // H=730
    [411, 418, 425, 438, 444, 457, 466, 473, 481, 502, 510, 519, 527, 537, 546, 553, 565, 575, 585, 595, 605, 614, 624, 634, 645, 656, 664],
    // H=790
    [431, 439, 447, 459, 469, 478, 492, 498, 508, 521, 533, 547, 557, 571, 583, 596, 606, 620, 631, 643, 654, 666, 678, 691, 703, 714, 726],
    // H=855
    [445, 453, 465, 474, 486, 498, 507, 515, 522, 543, 552, 565, 578, 585, 598, 606, 619, 629, 641, 652, 663, 675, 689, 700, 712, 722, 734],
    // H=915
    [471, 476, 490, 498, 507, 519, 529, 542, 550, 570, 581, 590, 602, 610, 623, 633, 644, 656, 667, 680, 692, 704, 715, 726, 737, 750, 761],
    // H=980
    [499, 506, 514, 526, 537, 550, 562, 573, 582, 599, 613, 624, 635, 651, 661, 677, 689, 699, 712, 724, 736, 750, 763, 778, 792, 805, 818],
    // H=1040
    [524, 533, 544, 552, 568, 582, 592, 600, 616, 629, 646, 664, 679, 692, 709, 726, 740, 756, 768, 783, 796, 809, 820, 834, 847, 860, 874],
    // H=1105
    [538, 548, 562, 576, 584, 597, 612, 620, 630, 652, 668, 681, 693, 708, 724, 735, 749, 763, 778, 792, 806, 818, 831, 844, 857, 870, 885],
    // H=1165
    [551, 565, 579, 587, 599, 614, 625, 640, 652, 673, 685, 696, 708, 723, 733, 748, 760, 773, 788, 804, 817, 832, 845, 860, 874, 890, 906],
    // H=1230
    [577, 589, 599, 613, 621, 641, 651, 666, 677, 695, 712, 728, 744, 759, 775, 791, 809, 824, 838, 854, 867, 883, 899, 913, 928, 941, 957],
    // H=1290
    [591, 602, 613, 626, 641, 652, 668, 681, 693, 713, 730, 746, 761, 777, 796, 812, 826, 842, 858, 874, 893, 909, 924, 939, 956, 971, 989],
    // H=1355
    [611, 622, 639, 651, 666, 679, 694, 705, 719, 744, 758, 770, 786, 803, 817, 830, 844, 858, 874, 893, 909, 925, 940, 956, 972, 990, 1006],
    // H=1415
    [625, 641, 653, 671, 682, 695, 710, 726, 740, 761, 777, 791, 806, 821, 837, 852, 865, 881, 899, 915, 930, 948, 963, 979, 997, 1013, 1030],
    // H=1480 (era 1490 - CORRETTO!)
    [645, 654, 672, 683, 701, 717, 730, 745, 759, 778, 801, 819, 838, 855, 878, 897, 913, 934, 952, 969, 989, 1006, 1023, 1040, 1058, 1075, 1094],
    // H=1540
    [663, 675, 692, 707, 723, 737, 755, 767, 779, 804, 821, 840, 856, 876, 896, 911, 929, 948, 966, 983, 1003, 1019, 1037, 1053, 1072, 1090, 1109],
    // H=1605
    [679, 696, 713, 724, 742, 756, 771, 787, 803, 825, 844, 860, 880, 898, 913, 931, 951, 969, 990, 1009, 1030, 1050, 1068, 1089, 1109, 1128, 1146],
    // H=1665
    [696, 712, 724, 741, 755, 771, 788, 804, 821, 844, 860, 880, 898, 913, 933, 953, 970, 990, 1008, 1026, 1045, 1063, 1082, 1100, 1119, 1138, 1158],
    // H=1730
    [747, 763, 778, 797, 814, 830, 846, 860, 880, 901, 921, 937, 958, 981, 1000, 1018, 1038, 1059, 1078, 1097, 1117, 1138, 1158, 1178, 1199, 1221, 1242],
    // H=1790
    [761, 776, 796, 812, 828, 847, 861, 879, 896, 921, 936, 956, 977, 995, 1012, 1030, 1048, 1065, 1085, 1105, 1124, 1144, 1163, 1183, 1203, 1224, 1244],
    // H=1855
    [783, 800, 818, 832, 848, 869, 888, 900, 921, 945, 965, 984, 1004, 1025, 1044, 1063, 1085, 1106, 1126, 1147, 1168, 1189, 1210, 1232, 1254, 1276, 1298],
    // H=1915
    [824, 839, 857, 876, 898, 911, 930, 951, 976, 993, 1017, 1033, 1050, 1070, 1102, 1131, 1160, 1190, 1211, 1234, 1257, 1280, 1304, 1328, 1353, 1378, 1403],
    // H=1980
    [840, 859, 876, 896, 914, 934, 954, 971, 997, 1017, 1038, 1055, 1072, 1098, 1128, 1157, 1183, 1215, 1238, 1261, 1285, 1309, 1334, 1359, 1385, 1412, 1438],
    // H=2040
    [855, 874, 895, 909, 931, 950, 972, 990, 1017, 1033, 1054, 1073, 1098, 1114, 1145, 1174, 1208, 1240, 1264, 1289, 1314, 1339, 1365, 1391, 1418, 1446, 1473],
    // H=2105
    [869, 895, 919, 936, 957, 979, 997, 1016, 1043, 1064, 1087, 1105, 1127, 1145, 1174, 1208, 1240, 1269, 1295, 1321, 1347, 1374, 1401, 1429, 1457, 1486, 1515],
    // H=2165
    [889, 911, 933, 954, 977, 995, 1016, 1034, 1057, 1085, 1107, 1126, 1149, 1165, 1202, 1230, 1264, 1296, 1326, 1357, 1382, 1408, 1434, 1461, 1488, 1517, 1545],
    // H=2230
    [904, 925, 951, 971, 991, 1013, 1035, 1051, 1083, 1103, 1126, 1148, 1164, 1185, 1219, 1255, 1288, 1321, 1352, 1382, 1422, 1452, 1485, 1521, 1556, null, null],
    // H=2290
    [919, 944, 965, 985, 1010, 1028, 1048, 1067, 1100, 1121, 1143, 1163, 1188, 1208, 1239, 1269, 1304, 1334, 1365, 1397, 1431, 1463, 1490, 1525, 1557, null, null],
    // H=2355
    [936, 962, 981, 1001, 1026, 1044, 1065, 1087, 1120, 1142, 1163, 1182, 1208, 1227, 1262, 1294, 1324, 1356, 1385, 1422, 1451, 1483, 1514, 1546, 1577, null, null],
    // H=2415
    [950, 970, 992, 1013, 1040, 1060, 1083, 1107, 1140, 1161, 1186, 1204, 1223, 1252, 1281, 1316, 1345, 1377, 1412, 1442, 1474, 1505, 1536, 1568, 1599, null, null],
    // H=2480
    [964, 986, 1009, 1030, 1058, 1077, 1105, 1124, 1158, 1181, 1208, 1219, 1244, 1271, 1309, 1337, 1368, 1399, 1432, 1464, 1492, 1528, 1558, 1590, 1620, null, null],
    // H=2540
    [981, 1003, 1023, 1043, 1073, 1095, 1122, 1142, 1174, 1206, 1228, 1241, 1264, 1296, 1326, 1357, 1386, 1424, 1456, 1487, 1521, 1551, 1585, 1618, 1648, null, null],
    // H=2605
    [995, 1016, 1037, 1059, 1090, 1110, 1140, 1159, 1199, 1227, 1253, 1264, 1281, 1317, 1347, 1379, 1414, 1446, 1478, 1510, 1542, 1576, 1611, 1641, 1672, null, null],
    // H=2665
    [1009, 1031, 1054, 1076, 1106, 1129, 1155, 1178, 1217, 1247, 1272, 1302, 1326, 1353, 1378, 1410, 1434, 1467, 1492, 1525, 1552, 1583, 1616, 1643, 1671, null, null],
    // H=2730
    [1030, 1052, 1073, 1097, 1121, 1148, 1172, 1201, 1240, 1267, 1296, 1336, 1371, 1391, 1414, 1433, 1455, 1487, 1512, 1541, 1569, 1597, 1624, 1649, 1676, null, null],
    // H=2790
    [1044, 1068, 1093, 1117, 1138, 1162, 1192, 1216, 1260, 1288, 1318, 1375, 1422, 1430, 1444, 1459, 1478, 1508, 1532, 1556, null, null, null, null, null, null, null]
]
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ†• v8.505: SUPPLEMENTI TELAIO CON GRUPPI COLORE A/B
    // Riferimento: Listino Finstral EUR 2025/10 (VERIFICATO)
    // 
    // STRUTTURA: pvcA/pvcB = supplemento PVC interno (â‚¬/ml)
    //            aluA/aluB = supplemento rivestimento ALU esterno (â‚¬/ml)
    // Gruppo A = bianco (01, 42, 45, 07, 27)
    // Gruppo B = colori scuri (06, 13, 19, 55, 36, 46)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    supplementiTelaio: {
"961": { pvcA: 0, pvcB: 5.31, aluA: 17.5, aluB: 20.9 },      // pag.10-11
"962": { pvcA: 0, pvcB: 5.61, aluA: 17.5, aluB: 22.9 },      // pag.12-13
"963": { pvcA: 2.95, pvcB: 9.50, aluA: 18.3, aluB: 25.4 },   // pag.14
"964": { pvcA: 3.60, pvcB: 8.80, aluA: 15.0, aluB: 17.3 },   // pag.18-19
"965": { pvcA: 7.71, pvcB: 13.1, aluA: 15.0, aluB: 17.3 },   // pag.20-21 âœ… Verificato conferma Ruggeri
"966": { pvcA: 11.8, pvcB: 17.7, aluA: 15.0, aluB: 17.3 },   // pag.20-21
"967": { pvcA: 11.1, pvcB: 15.6, aluA: 17.5, aluB: 20.9 },   // pag.22
"Z62": { pvcA: 5.32, pvcB: 10.6, aluA: 15.0, aluB: 18.3 },   // pag.23
"Z91": { pvcA: 16.4, pvcB: 22.2, aluA: 15.0, aluB: 18.3 },   // pag.23
"924": { pvcA: 8.83, pvcB: 14.3, aluA: 18.0, aluB: 21.3 },   // stimato
"991": { pvcA: 10.9, pvcB: 16.5, aluA: 18.0, aluB: 21.3 },   // stimato
"951": { pvcA: 13.0, pvcB: 20.1, aluA: 19.5, aluB: 23.8 }    // stimato
    },

    // âœ… v8.10: RIVESTIMENTO TELAIO ALLUMINIO (â‚¬/ml) - Listino EUR 2025/3 pag.10-11
    // Questo Ã¨ il supplemento per il RIVESTIMENTO esterno in alluminio
    // Si applica INVECE di supplementiTelaio quando finituraEst = alluminio
    // âœ… v8.45 CORRETTO: Rivestimenti telaio alluminio da listino EUR 2025/10
    // Valori: PVC-PVC / PVC-ALU (â‚¬/ml)
    rivestimentiTelaiAlluminio: {
// Codice telaio: { pvcPvc: valore PVC-PVC, pvcAlu: valore PVC-ALU }
"961N":  { pvcPvc: 17.5, pvcAlu: 20.9 },   // Standard
"961N5": { pvcPvc: 18.3, pvcAlu: 19.7 },   // Sottile
"961X":  { pvcPvc: 24.1, pvcAlu: 26.0 },   // Speciale (solo laterali/superiore)
"962N":  { pvcPvc: 17.5, pvcAlu: 22.9 },
"962N5": { pvcPvc: 18.3, pvcAlu: 19.7 },
"963N":  { pvcPvc: 18.0, pvcAlu: 24.9 },
"963N5": { pvcPvc: 18.0, pvcAlu: 19.3 },
"967N":  { pvcPvc: 20.4, pvcAlu: 24.0 },   // Forma Z
"Z62N":  { pvcPvc: 18.3, pvcAlu: 20.9 },   // âœ… v8.45: Corretto da listino
"Z91N":  { pvcPvc: 18.3, pvcAlu: 22.0 }
    },

    // âœ… v8.10: Colori alluminio gruppo B (scuri/legno verniciato)
    // Iniziano con L (Lxx) o sono colori scuri
    coloriAlluminioGruppoB: [
"L01", "L02", "L03", "L04", "L05", "L06", "L07", "L08", "L09", "L10",
"L11", "L12", "L13", "L14", "L15", "L16", "L17", "L18", "L19", "L20",
"L21", "L22", "L23", "L24", "L25", "L26", "L27", "L28", "L29", "L30"
    ],

    // SUPPLEMENTI VETRO (EUR/mÂ²) - Listino 2025/3
    supplementiVetro: {
"2F48": 0,           // Doppio base (incluso)
"2113": 52.20,       // Doppio Plus-Valor 2
"11414": 118.00,     // Triplo Max-Valor 3
standard: 0,
doppio: 0,           // Alias
triplo: 118.00,      // Alias 11414
multiprotect2148: 12.70,
multiprotectP2A: 44.80,
multiprotectP4A: 67.40,
multiprotectP5A: 103.00,
// ğŸ†• v8.45: Supplementi vetro satinato (da listino EUR 2025/10)
"48": 54.70,         // Vetro satinato bianco 4mm
"486": 66.50,        // Vetro satinato bianco 6mm
"488": 82.40,        // Vetro satinato bianco 8mm
"48T": 83.40,        // Bodysafe vetro satinato 4mm
"486T": 90.40,       // Bodysafe vetro satinato 6mm
"488T": 132.00,      // Bodysafe vetro satinato 8mm
satinato: 82.40,     // Alias default (488)
"satinato-bodysafe": 132.00  // Alias Bodysafe
    },

    // âœ… v7.73: SOGLIA PORTA-FINESTRA (EUR/ml)
    // âœ… v8.10: Corretto prezzo da 53.40 a 54.50 (listino Finstral)
    supplementiSoglia: {
"codice3": 54.50,         // Soglia ribassata a taglio termico
"codice3_scorrevole": 54.50,
allargamento30: 24.10,   // +30mm PVC
allargamento30K: 25.90   // +30mm alluminio
    },
    
    // âœ… v8.466: SUPPLEMENTI FERRAMENTA SCORREVOLE (EUR/pezzo)
    // Riferimento: Listino Finstral EUR 2025/10 pag.201
    supplementiFerramenta: {
// Ferramenta scorrevole parallelo a ribalta
"710": 760,      // codice 710.0
"710.0": 760,
"711": 859,      // codice 711.0.0 (+ doppia maniglia e serratura)
"711.0": 859,
// Ferramenta scorrevole parallelo
"720": 760,      // codice 720.0
"720.0": 760,
"721": 859,      // codice 721.0 (+ doppia maniglia e serratura)
"721.0": 859,
// Ferramenta montante mobile scorrevole
"722": 760,      // codice 722.0
"722.0": 760,
// Ferramenta apertura ad anta (per tipo 503)
"430": 14.80,    // codice 430.0 (cerniere in vista)
"430.0": 14.80,
"230": 20.70,    // codice 230.0 (cerniere a scomparsa)
"230.0": 20.70,
// Sicurezza ferramenta scorrevole
"710.4": 6.12,   // Scontri sicurezza perimetrali
"710.3": 27.90,  // Scontri sicurezza multipli
    },
    
    // âœ… v8.466: CONFIGURAZIONE TIPI SCORREVOLI
    // Riferimento: Listino Finstral EUR 2025/10 pag.156
    tipiScorrevoli: {
// codiceModello: { campi: [tipi tabella], ferramenta: [codici], fattore: moltiplicatore }
// ğŸ†• v8.478: Tipo 500 scorrevole parallela ha prezzo base â‰ˆ2Ã— tabella 101
// ğŸ†• v8.478: supplementoFerramenta automatico per tipo 500 (â‚¬760 per meccanica scorrevole)
"500": { descrizione: "Scorrevole parallela", campi: ["101"], fattorePrezzo: 1.97, supplementoFerramenta: 760, note: "prezzo base Ã— 1.97 + ferramenta automatica â‚¬760" },
"501": { descrizione: "Scorrevole + fisso", campi: ["101", "102"], note: "campo1 anta + campo2 fisso" },
"503": { descrizione: "Scorrevole + anta apribile", campi: ["101", "101"], ferramenta430: true, note: "campo1 anta(430) + campo2 scorrevole" },
"504": { descrizione: "Scorrevole maniglia estraibile", campi: ["101", "101"], note: "apertura tramite maniglia estraibile" },
"505": { descrizione: "Scorrevole + anta + fisso", campi: ["101", "101", "102"], note: "3 campi" },
"510": { descrizione: "Scorrevole 2 ante", campi: ["101", "101"], note: "anta che apre per prima e anta secondaria" },
"511": { descrizione: "Fisso + scorrevole", campi: ["102", "101"], note: "campo1 fisso + campo2 scorrevole" },
"513": { descrizione: "Fisso + scorrevole + fisso", campi: ["102", "101", "102"], note: "3 campi" },
"514": { descrizione: "4 campi misti", campi: ["102", "101", "101", "102"], note: "4 campi" },
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ†• v8.505: SUPPLEMENTO PROFILO ANTA CON GRUPPI COLORE A/B
    // Riferimento: Listino Finstral EUR 2025/10 (VERIFICATO)
    // 
    // STRUTTURA: pvcA/pvcB = supplemento PVC anta (â‚¬/ml perimetro anta)
    //            aluA/aluB = supplemento rivestimento ALU anta (â‚¬/ml)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    supplementiProfiloAnta: {
"classic-line": { pvcA: 0, pvcB: 6.35, aluA: 10.7, aluB: 11.6 },      // codice 973K - pag.117 âœ…
"step-line": { pvcA: 0, pvcB: 6.24, aluA: 10.7, aluB: 11.2 },          // codice 974N - pag.130
"slim-line": { pvcA: 1.97, pvcB: 9.05, aluA: 12.7, aluB: 13.2 },       // codice 970 - pag.117
"slim-line-cristal": { pvcA: 1.97, pvcB: 9.05, aluA: 12.7, aluB: 13.2 },
"slim-line-twin": { pvcA: 1.97, pvcB: 9.05, aluA: 12.7, aluB: 13.2 },
"nova-line": { pvcA: 5.62, pvcB: 11.9, aluA: 0, aluB: 0 },             // codice 971/953 - pag.134 (vetro esterno)
"nova-line-30": { pvcA: 5.62, pvcB: 11.9, aluA: 0, aluB: 0 },
"nova-line-40": { pvcA: 5.62, pvcB: 11.9, aluA: 0, aluB: 0 },
"nova-line-plus": { pvcA: 23.1, pvcB: 29.3, aluA: 0, aluB: 0 },        // codice 941 - pag.136
"nova-line-twin": { pvcA: 5.62, pvcB: 11.9, aluA: 0, aluB: 0 }
    },

    // âœ… v7.79: TABELLE DIMENSIONALI ANTE SPECIALI (â‚¬/pezzo invece di â‚¬/ml)
    // Riferimento: Listino Finstral EUR 2025/3 pag.85-95
    // Queste ante hanno prezzo a tabella dimensionale invece che â‚¬/ml
    tabelleAnteDimensionali: {
// Slim-line Cristal (codice 954) - pag.85
// [A mm][L mm] = â‚¬/pezzo supplemento
"slim-line-cristal": {
    605: { 615: 232, 740: 247, 865: 264, 990: 285, 1115: 301, 1240: 317, 1365: 333, 1490: 341, 1615: 359, 1740: 374, 1865: 389, 1990: 405, 2115: 420 },
    730: { 615: 247, 740: 267, 865: 286, 990: 309, 1115: 328, 1240: 347, 1365: 368, 1490: 380, 1615: 398, 1740: 416, 1865: 434, 1990: 453, 2115: 473 },
    855: { 615: 265, 740: 286, 865: 307, 990: 333, 1115: 356, 1240: 379, 1365: 401, 1490: 416, 1615: 437, 1740: 460, 1865: 481, 1990: 503, 2115: 524 },
    980: { 615: 285, 740: 310, 865: 334, 990: 365, 1115: 390, 1240: 415, 1365: 440, 1490: 458, 1615: 483, 1740: 508, 1865: 532 },
    1105: { 615: 302, 740: 329, 865: 358, 990: 390, 1115: 418, 1240: 446, 1365: 476, 1490: 496, 1615: 523, 1740: 550, 1865: 580 },
    1230: { 615: 318, 740: 348, 865: 380, 990: 415, 1115: 446, 1240: 479, 1365: 510, 1490: 533, 1615: 565 },
    1355: { 615: 334, 740: 369, 865: 402, 990: 440, 1115: 476, 1240: 510, 1365: 544, 1490: 572, 1615: 605 },
    1480: { 615: 343, 740: 381, 865: 417, 990: 460, 1115: 497, 1240: 534, 1365: 572, 1490: 602, 1615: 638 },
    1605: { 615: 361, 740: 400, 865: 438, 990: 485, 1115: 524, 1240: 566, 1365: 606, 1490: 638, 1615: 679 },
    1730: { 615: 376, 740: 418, 865: 462, 990: 509, 1115: 552, 1240: 596, 1365: 639, 1490: 676, 1615: 718 },
    1855: { 615: 392, 740: 437, 865: 483, 990: 533, 1115: 581, 1240: 627, 1365: 674, 1490: 712, 1615: 758 },
    1980: { 615: 399, 740: 446, 865: 495, 990: 548, 1115: 598, 1240: 646, 1365: 696, 1490: 736, 1615: 785 },
    2105: { 615: 414, 740: 467, 865: 517, 990: 574, 1115: 625, 1240: 678, 1365: 729, 1490: 774 },
    2230: { 615: 430, 740: 485, 865: 538, 990: 599, 1115: 653, 1240: 708, 1365: 763 },
    2355: { 615: 446, 740: 504, 865: 562, 990: 623, 1115: 682, 1240: 739 },
    2480: { 615: 463, 740: 522, 865: 583, 990: 647, 1115: 709, 1240: 771 },
    2605: { 615: 479, 740: 541, 865: 605, 990: 674, 1115: 737 },
    2730: { 615: 494, 740: 560, 865: 626, 990: 698, 1115: 766 }
},
// Slim-line Twin (codici C788/C988) - pag.87
"slim-line-twin": {
    605: { 615: 144, 740: 152, 865: 158, 990: 166, 1115: 171, 1240: 177, 1365: 186, 1490: 193 },
    730: { 615: 148, 740: 159, 865: 164, 990: 173, 1115: 179, 1240: 186, 1365: 194, 1490: 202 },
    855: { 615: 158, 740: 167, 865: 173, 990: 181, 1115: 188, 1240: 197, 1365: 205, 1490: 213 },
    980: { 615: 175, 740: 185, 865: 191, 990: 200, 1115: 207, 1240: 215, 1365: 225, 1490: 234 },
    1105: { 615: 180, 740: 189, 865: 197, 990: 206, 1115: 214, 1240: 224, 1365: 233, 1490: 244 },
    1230: { 615: 187, 740: 198, 865: 205, 990: 215, 1115: 224, 1240: 233, 1365: 244, 1490: 256 },
    1355: { 615: 200, 740: 212, 865: 219, 990: 230, 1115: 239, 1240: 250, 1365: 262, 1490: 273 },
    1480: { 615: 198, 740: 209, 865: 218, 990: 228, 1115: 239, 1240: 250, 1365: 263, 1490: 274 },
    1605: { 615: 212, 740: 225, 865: 233, 990: 239, 1115: 258, 1240: 269, 1365: 281, 1490: 293 },
    1730: { 615: 218, 740: 230, 865: 239, 990: 245, 1115: 264, 1240: 276, 1365: 289, 1490: 302 },
    1855: { 615: 225, 740: 238, 865: 248, 990: 256, 1115: 275, 1240: 287, 1365: 300, 1490: 314 },
    1980: { 615: 227, 740: 241, 865: 251, 990: 260, 1115: 277, 1240: 290, 1365: 303, 1490: 316 },
    2105: { 615: 232, 740: 246, 865: 259, 990: 273, 1115: 285, 1240: 298, 1365: 312, 1490: 325 },
    2230: { 615: 245, 740: 261, 865: 273, 990: 287, 1115: 299, 1240: 313, 1365: 327, 1490: 341 },
    2355: { 615: 256, 740: 271, 865: 282, 990: 298, 1115: 311, 1240: 325, 1365: 340, 1490: 355 },
    2480: { 615: 258, 740: 274, 865: 286, 990: 301, 1115: 314, 1240: 329, 1365: 345, 1490: 363 },
    2605: { 615: 266, 740: 281, 865: 294, 990: 311, 1115: 325, 1240: 340, 1365: 356, 1490: 374 },
    2730: { 615: 273, 740: 289, 865: 303, 990: 320, 1115: 335, 1240: 350, 1365: 368, 1490: 384 }
},
// Nova-line Twin (codice N989) - pag.94
"nova-line-twin": {
    605: { 615: 231, 740: 244, 865: 254, 990: 267, 1115: 277, 1240: 289, 1365: 302, 1490: 303 },
    730: { 615: 241, 740: 257, 865: 268, 990: 282, 1115: 293, 1240: 306, 1365: 320, 1490: 324 },
    855: { 615: 254, 740: 271, 865: 283, 990: 298, 1115: 311, 1240: 326, 1365: 341, 1490: 346 },
    980: { 615: 278, 740: 295, 865: 308, 990: 325, 1115: 339, 1240: 358, 1365: 375, 1490: 381 },
    1105: { 615: 287, 740: 306, 865: 321, 990: 339, 1115: 355, 1240: 374, 1365: 393, 1490: 401 },
    1230: { 615: 300, 740: 320, 865: 336, 990: 358, 1115: 375, 1240: 394, 1365: 414, 1490: 423 },
    1355: { 615: 318, 740: 340, 865: 360, 990: 381, 1115: 399, 1240: 420, 1365: 442, 1490: 452 },
    1480: { 615: 320, 740: 343, 865: 365, 990: 387, 1115: 407, 1240: 429, 1365: 452, 1490: 466 },
    1605: { 615: 340, 740: 366, 865: 387, 990: 404, 1115: 432, 1240: 457, 1365: 483, 1490: 496 },
    1730: { 615: 350, 740: 378, 865: 400, 990: 419, 1115: 448, 1240: 476, 1365: 501, 1490: 517 },
    1855: { 615: 364, 740: 391, 865: 415, 990: 435, 1115: 468, 1240: 495, 1365: 523, 1490: 539 },
    1980: { 615: 371, 740: 399, 865: 424, 990: 445, 1115: 479, 1240: 507, 1365: 535, 1490: 552 },
    2105: { 615: 381, 740: 411, 865: 437, 990: 468, 1115: 494, 1240: 524, 1365: 553, 1490: 574 },
    2230: { 615: 399, 740: 430, 865: 458, 990: 490, 1115: 518, 1240: 549, 1365: 582, 1490: 602 },
    2355: { 615: 413, 740: 446, 865: 477, 990: 509, 1115: 539, 1240: 573, 1365: 605, 1490: 627 },
    2480: { 615: 420, 740: 455, 865: 487, 990: 520, 1115: 551, 1240: 587, 1365: 621, 1490: 644 },
    2605: { 615: 433, 740: 470, 865: 502, 990: 537, 1115: 572, 1240: 607, 1365: 642, 1490: 669 },
    2730: { 615: 445, 740: 484, 865: 518, 990: 554, 1115: 590, 1240: 627, 1365: 666, 1490: 692 }
}
    },

    // âœ… v7.79: MONTANTE CENTRALE / NODO (EUR/pezzo) - Aggiornato con nodi specifici
    // Riferimento: Listino Finstral EUR 2025/3 pag.83-95
    supplementiMontante: {
// Nodi standard (Classic, Step, Slim)
"codice28": { pvcA: 0, pvcB: 2.35, aluA: 26.70, aluB: 29.10, aluC: 30.70, aluD: 33.00 },      // Standard
"codice25": { pvcA: 8.40, pvcB: 12.70, aluA: 35.10, aluB: 39.40, aluC: 39.00, aluD: 43.30 },  // Sottile
"codiceS28": { pvcA: 11.00, pvcB: 14.90, aluA: 37.70, aluB: 41.60, aluC: 41.70, aluD: 45.50 }, // Slanciato
"codiceH25": { pvcA: 11.60, pvcB: 15.90, aluA: 38.40, aluB: 42.60, aluC: 42.20, aluD: 46.50 }, // History
// âœ… v7.79: Nodi specifici Nova-line
"NL45": { pvcA: 0, pvcB: 2.35, aluA: 27.80, aluB: 30.10, aluC: 31.70, aluD: 34.00 },   // Nova-line sottile
"C45": { pvcA: 0, pvcB: 3.06, aluA: 27.80, aluB: 30.10, aluC: 31.70, aluD: 34.00 },    // Twin
"N45": { pvcA: 0, pvcB: 2.35, aluA: 27.80, aluB: 30.10, aluC: 31.70, aluD: 34.00 },    // Nova Twin sottile
"56": { pvcA: 46.10, aluA: 46.10 },    // Nova-line Plus nodo vetro
"N56": { pvcA: 46.10, aluA: 46.10 }    // Nova Twin vetro
    },

    // âœ… v7.79: Mappa tipo anta â†’ codice nodo
    nodiPerTipoAnta: {
"classic-line": "codice28",
"step-line": "codice28",
"slim-line": "codice28",
"slim-line-cristal": "codice28",
"slim-line-twin": "C45",
"nova-line": "NL45",
"nova-line-30": "NL45",
"nova-line-40": "NL45",
"nova-line-plus": "56",
"nova-line-twin": "N45"
    },

    // âœ… v7.75: TAGLI SUI TELAI (EUR/ml) - Listino pag.22-28
    // I codici arrivano dal JSON (campo pos.infisso.taglio o tagli[])
    supplementiTagli: {
// Tagli standard â‚¬2.19/ml
"127": 2.19, "107": 2.19, "163": 2.19, "162": 2.19, 
"5N": 2.19, "179N": 2.19, "5X": 2.19, "179X": 2.19,
"128": 2.19, "110": 2.19, "136": 2.19, "115": 2.19,
"100": 2.19, "120": 2.19, "125": 2.19, "130": 2.19,
"140": 2.19, "178": 2.19, "135": 2.19, "145": 2.19,
"150": 2.19, "160": 2.19, "131": 2.19,
"151": 2.19, "156": 2.19, "157": 2.19, "119": 2.19,
"124": 2.19, "152": 2.19, "121": 2.19,
// Tagli â‚¬2.75/ml
"164": 2.75, "165": 2.75, "116": 2.75, "167": 2.75,
"129": 2.75, "132": 2.75, "153": 2.75, "133": 2.75,
"166": 2.75, "169": 2.75,
// Tagli speciali â‚¬5.22/ml
"118": 5.22, "172": 5.22, "149": 5.22, "147": 5.22,
"148": 5.22, "134": 5.22, "176": 5.22, "191": 5.22,
"192": 5.22
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ†• v8.505: GRUPPI COLORE PVC - PER LOOKUP
    // I supplementi sono ora in supplementiTelaio e supplementiProfiloAnta
    // con struttura pvcA/pvcB/aluA/aluB
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    supplementiColorePVC: {
gruppoA: ["01", "45", "27", "42", "07"],  // bianco, bianco satinato, bianco perla, bianco goffrato, bianco perla goffrato
gruppoB: ["46", "06", "13", "19", "55", "36"],  // grigio seta, grigio, castagno, rovere, noce chiaro, grigio topo
// ğŸ†• v8.505: I supplementi colore sono ORA INTEGRATI in supplementiTelaio e supplementiProfiloAnta
// Usare pvcA per gruppo A, pvcB per gruppo B
// La sezione "anta" Ã¨ mantenuta per retrocompatibilitÃ 
anta: {
    "classic-line": [0, 6.35],      // Allineato a supplementiProfiloAnta.pvcB
    "step-line": [0, 6.24],
    "slim-line": [0, 6.93],
    "nova-line": [0, 6.09],
    "nova-line-30": [0, 6.09],
    "nova-line-40": [0, 6.09],
    "nova-line-plus": [0, 6.20]
}
    },

    // âœ… v7.64: SUPPLEMENTI COLORE ALLUMINIO (per rivestimento esterno)
    // Gruppo 1 = standard, 1H = decori legno, 2 = RAL (+284â‚¬/ordine), 3 = NCS/speciali (+1410â‚¬/ordine)
    supplementiColoreAlluminio: {
gruppo1: {
    codici: ["F05", "F45", "F90", "F91", "F113", "F609", "F703", "F716", "F739", "F742", "F744", "F819", "F901", "F905",
             "M01", "M605", "M716", "M722", "M817", "M906", "M907", "M905", "M910", "M916", "9017",
             "303", "583", "893", "894", "2525", "DB703"],
    costoPreparazione: 0
},
gruppo1H: {
    codici: ["L13", "L14", "L16", "L18", "L19", "L55", "LX01", "LX02", "LX03", "LX04"],
    costoPreparazione: 0
},
gruppo2: {
    codici: ["F09", "F92", "F93", "F94", "F95", "F119", "F305", "F511", "F612", "F702", "F721", "F722", "F723", "F822", "F918", "F958",
             "M822", "L05", "L56", "LC31", "LC32", "LC33", "LC34", "203", "304", "805", "358", "658", "691", "897", "FB73", "RAL"],
    costoPreparazione: 284  // â‚¬/ordine
},
gruppo3: {
    codici: ["NCS", "DB"],  // colori speciali
    costoPreparazione: 1410  // â‚¬/ordine
},
// Supplementi â‚¬/ml per anta alluminio [gruppo1, gruppo2-3]
anta: {
    "classic-line": [10.50, 11.40],
    "step-line": [10.50, 10.90],
    "slim-line": [12.40, 12.90],
    "nova-line": [0, 0]  // Nova-line ha vetro esterno, no rivestimento
}
    },

    // âœ… v7.64: DATABASE COLORI COMUNI (per lookup rapido)
    coloriComuni: {
"bianco": { pvc: "01", alluminio: "M01", gruppo: "A/1" },
"bianco satinato": { pvc: "45", alluminio: "F45", gruppo: "A/1" },
"bianco perla": { pvc: "27", alluminio: "F113", gruppo: "A/1" },
"grigio seta": { pvc: "46", alluminio: "F744", gruppo: "B/1" },
"grigio traffico": { pvc: null, alluminio: "F742", gruppo: "1" },
"grigio antracite": { pvc: null, alluminio: "F716", gruppo: "1" },
"castagno": { pvc: "13", alluminio: "L13", gruppo: "B/1H" },
"rovere": { pvc: "19", alluminio: "L19", gruppo: "B/1H" },
"noce chiaro": { pvc: "55", alluminio: "L55", gruppo: "B/1H" },
"nero intenso": { pvc: null, alluminio: "F905", gruppo: "1" },
"RAL 7016": { pvc: null, alluminio: "RAL", gruppo: "2" },
"RAL 9005": { pvc: null, alluminio: "RAL", gruppo: "2" }
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… v7.77: FERRAMENTA / APERTURE / CERNIERE
    // Riferimento: Listino Finstral EUR 2025/3 pag.116-157
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // TIPI APERTURA con codici ferramenta
    tipiApertura: {
"AR": { 
    nome: "Anta/Ribalta", 
    codiceVista: "411.0", 
    codiceScomparsa: "211.0",
    minL: 350, minH: 325
},
"A": { 
    nome: "Solo Anta", 
    codiceVista: "430.0", 
    codiceScomparsa: "230.0",
    minL: 350, minH: 325
},
"R": { 
    nome: "Solo Ribalta", 
    codiceVista: "432.0", 
    codiceScomparsa: "232.0",
    minL: 350, minH: 325
},
"FX": { 
    nome: "Fisso", 
    codiceVista: "99.0", 
    codiceScomparsa: null,
    minL: 300, minH: 250
},
"VA": { 
    nome: "Vasistas", 
    codiceVista: "433.0", 
    codiceScomparsa: "233.0",
    minL: 564, minH: 306
},
"SP": { 
    nome: "Scorrevole Parallela", 
    codiceVista: "720.0", 
    codiceScomparsa: null,  // Scorrevole usa carrelli, no cerniere
    minL: 710, minH: 841
},
"SPR": { 
    nome: "Scorrevole Parallela Ribalta", 
    codiceVista: "710.0", 
    codiceScomparsa: null,
    minL: 710, minH: 841
},
"PFS": { 
    nome: "Porta-Finestra Serratura", 
    codiceVista: "475.0", 
    codiceScomparsa: "275.0",
    minL: 441, minH: 1626
}
    },

    // CERNIERE: supplemento per cerniere a scomparsa (â‚¬ per unitÃ )
    // Vista (4xx.0) = â‚¬0 incluse, Scomparsa (2xx.0) = supplemento
    supplementiCerniere: {
"AR": 47.0,      // Anta/Ribalta scomparsa 211.0
"AR_primaria": 76.0,  // Ribalta primaria 209.0
"A": 61.5,       // Solo anta 230.0
"R": 67.1,       // Solo ribalta 232.0
"VA": 63.2,      // Vasistas 231.0/233.0
"PFS": 189.0,    // Porta-finestra serratura 275.0
"AR_montante": 72.4   // Montante alto B211.0
    },

    // SICUREZZA: allestimenti antieffrazione
    supplementiSicurezza: {
"perimetrali": 18.8,           // .411.4 scontri perimetrali
"perimetrali_angolare": 27.4,  // .3 + cerniera angolare
"antiSgancio": 40.4,           // ...2 dispositivo
"contattoZ9": 57.8,            // Z9 magnetico 10m
"contattoZ9_VdS": 70.3,        // Z9V certificato VdS
"contattoZ92": 115.0,          // Z92 magnetico 20m
"bloccoChiave": 34.2           // D0010 blocco anta
    },

    // ACCESSORI AERAZIONE
    supplementiAerazione: {
"estateInverno1": 14.5,    // 20-1 una anta (170â†’40mm)
"estateInverno2": 14.5,    // 20-2 due ante
"aerazioneLimitata1": 7.28, // 14-1 apertura ~5mm
"aerazioneLimitata2": 7.28  // 14-2 due ante
    },

    // COMFORT: dispositivi facilitazione
    supplementiComfort: {
"facilitaChiusura": 37.6,  // 4111/2111 ante pesanti
"fermoAntaFB200": 11.6     // min L 450mm
    },

    // SCORREVOLI: supplementi specifici
    supplementiScorrevoli: {
"parallelaRibalta": 745.0,      // 710.0
"parallelaRibaltaSer": 842.0,   // 711.0 con serratura
"parallela": 745.0,             // 720.0
"parallelaSer": 842.0,          // 721.0 con serratura
"montanteMobile": 745.0         // 722.0
    },

    // VASISTAS CON COMANDI: supplementi per altezza
    supplementiVasistasComando: {
"manigliaSuperiore": { base: 24.5, scomparsa: 63.2 },  // 10cm apertura
"astaLeva": { base: 213, scomparsa: 252 },            // 19cm apertura
"astaArganello": { base: 257, scomparsa: 296 },       // 19cm apertura
"motore230V": { base: 669, scomparsa: 707 },          // 19cm apertura
"motore24V": { base: 825, scomparsa: 863 }            // 30cm apertura
    },

    // RC2 ANTIEFFRAZIONE: requisiti e supplementi
    rc2: {
requisiti: {
    ferramenta: ".3",           // Obbligatorio
    maniglia: ["6030", "7130"], // Con chiave
    vetro: "P4A",               // Antisfondamento
    minL: 540, minH: 700
},
supplemento: {
    "nova-line": 29.8,   // RC2NL
    "altri": 67.9        // RC2 standard
},
telaiCompatibili: ["924", "991", "923", "129", "961", "962", "963", "964", "965", "966", "967"]
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ  DATABASE FIN-SLIDE - ALZANTI SCORREVOLI (Listino EUR 2025/10)
// ğŸ†• v8.469 (12 GEN 2026) - Integrazione completa FIN-Slide
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.FINSLIDE_PREZZI = {
    versione: 'EUR 2025/10',
    validitaDa: '04/2026',
    dataAggiornamento: '2026-01-12',
    
    // ğŸ†• v8.483: Tipologie Telaio corrette da configuratore Finstral
    // Fonte: Listino FIN-Slide EUR 2025/10 pag.8
    telai: {
'90M': { nome: 'Telaio 90M', materiale: 'ALU-PVC', profondita: 168, supplementoMl: 40.5 },
'90N': { nome: 'Telaio 90N', materiale: 'ALU-PVC', profondita: 168, supplementoMl: 40.5 },
'090A0': { nome: 'Telaio 090A0 Hide', materiale: 'ALU-PVC', profondita: 160, supplementoMl: 26.6 },
'38B': { nome: 'Telaio 38B', materiale: 'ALU-PVC', profondita: 157, supplementoMl: 0 },  // base
'38C': { nome: 'Telaio 38C', materiale: 'ALU-PVC', profondita: 157, supplementoMl: 12.6 }
    },
    
    // Tipologie Anta
    ante: {
'Step-line Door': { codice: '591', spessoreAnta: 80, vetroBase: '2F63' },
'Step-line': { codice: '598', spessoreAnta: 65, vetroBase: '2F63' },
'Slim-line': { codice: '60L', spessoreAnta: 60, vetroBase: '2F63' },
'Slim-line Cristal': { codice: '60L', spessoreAnta: 60, vetroBase: '1HHHJ' },
'Nova-line Plus': { codice: 'M60', spessoreAnta: 60 }
    },
    
    // Griglia Prezzi Telaio 90 (PVC-PVC)
    prezziTelaio90: {
colonne: [1115, 1365, 1615, 1865, 2115, 2365, 2615, 2865, 3115, 3365, 3615, 3865, 4115, 4365, 4615, 4865, 5115, 5365, 5615, 5865, 5960],
prezzi: {
    1230: [478, 503, 525, 551, 578, 605, 630, 653, 680, 706, 732, 893, 920, 949, 976, 1006, 1034, 1062, 1093, 1122, 1133],
    1415: [494, 519, 544, 570, 598, 624, 647, 673, 701, 726, 753, 915, 944, 972, 1004, 1032, 1060, 1091, 1121, 1150, 1161],
    1605: [510, 536, 562, 589, 614, 641, 666, 695, 720, 746, 771, 939, 968, 1001, 1030, 1059, 1088, 1120, 1150, 1177, 1189],
    1790: [525, 551, 580, 607, 633, 659, 686, 712, 737, 764, 793, 965, 997, 1027, 1055, 1086, 1116, 1148, 1176, 1207, 1218],
    1980: [543, 571, 599, 626, 651, 678, 706, 732, 759, 787, 812, 993, 1023, 1053, 1083, 1114, 1145, 1174, 1205, 1234, 1245],
    2165: [561, 589, 614, 643, 668, 697, 724, 753, 777, 805, 831, 1019, 1048, 1079, 1110, 1141, 1170, 1203, 1232, 1262, 1274],
    2355: [578, 606, 633, 660, 690, 715, 744, 770, 799, 826, 853, 1044, 1075, 1107, 1137, 1168, 1201, 1229, 1260, 1290, 1304],
    2540: [597, 624, 650, 678, 707, 734, 762, 791, 818, 844, 871, 1067, 1101, 1132, 1163, 1192, 1226, 1257, 1286, 1320, 1330],
    2730: [612, 641, 667, 697, 726, 754, 779, 809, 837, 865, 896, 1095, 1127, 1159, 1189, 1221, 1254, 1284, 1316, 1348, 1361],
    2915: [630, 658, 686, 714, 742, 771, 801, 828, 857, 886, 914, 1122, 1154, 1183, 1217, 1246, 1281, 1313, 1343, 1375, 1386]
}
    },
    
    // Griglia Prezzi Telaio 38 (ALU-PVC)
    prezziTelaio38: {
colonne: [1115, 1365, 1615, 1865, 2115, 2365, 2615, 2865, 3115, 3365, 3615, 3865, 4115, 4365, 4615, 4865, 5115, 5365, 5615, 5865, 5960],
prezzi: {
    1230: [754, 786, 816, 844, 873, 907, 935, 965, 997, 1027, 1057, 1220, 1254, 1286, 1322, 1354, 1388, 1424, 1456, 1489, 1502],
    1415: [778, 810, 840, 870, 902, 931, 962, 995, 1023, 1054, 1085, 1254, 1286, 1322, 1355, 1388, 1424, 1458, 1490, 1527, 1538],
    1605: [804, 834, 866, 899, 927, 960, 991, 1021, 1052, 1083, 1115, 1286, 1322, 1355, 1391, 1425, 1459, 1492, 1529, 1563, 1575],
    1790: [829, 860, 893, 923, 954, 986, 1017, 1048, 1079, 1110, 1141, 1321, 1354, 1391, 1425, 1459, 1494, 1529, 1563, 1598, 1611],
    1980: [855, 886, 919, 950, 980, 1013, 1044, 1075, 1108, 1138, 1170, 1354, 1391, 1425, 1460, 1494, 1530, 1564, 1600, 1635, 1648],
    2165: [880, 912, 944, 975, 1008, 1039, 1071, 1102, 1133, 1167, 1197, 1386, 1424, 1459, 1494, 1529, 1564, 1600, 1635, 1670, 1684],
    2355: [906, 937, 967, 1001, 1033, 1063, 1098, 1129, 1162, 1192, 1226, 1423, 1458, 1492, 1529, 1564, 1600, 1635, 1671, 1707, 1722],
    2540: [928, 962, 995, 1027, 1059, 1091, 1124, 1156, 1188, 1221, 1254, 1455, 1490, 1528, 1563, 1598, 1635, 1670, 1704, 1743, 1755],
    2730: [954, 989, 1020, 1053, 1086, 1120, 1150, 1182, 1217, 1248, 1281, 1488, 1527, 1562, 1598, 1633, 1670, 1704, 1743, 1780, 1792],
    2915: [979, 1013, 1046, 1078, 1111, 1143, 1177, 1213, 1244, 1275, 1311, 1523, 1559, 1595, 1632, 1669, 1703, 1742, 1779, 1817, 1829]
}
    },
    
    // Griglia Prezzi Ante Step-line Door / Step-line (591/598)
    prezziAnteStepline: {
colonne: [990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740],
prezzi: {
    2040: [1455, 1535, 1583, 1633, 1682, 1731, 1780, 1829, 1877, 1928, 1975, 2025, 2074, 2123, 2172],
    2165: [1487, 1571, 1622, 1673, 1725, 1776, 1828, 1878, 1931, 1980, 2034, 2084, 2137, 2186, 2239],
    2290: [1521, 1605, 1659, 1713, 1768, 1822, 1875, 1929, 1983, 2036, 2089, 2144, 2197, 2252, 2304],
    2415: [1552, 1641, 1696, 1753, 1809, 1866, 1922, 1978, 2035, 2090, 2148, 2203, 2260, 2315, 2373],
    2540: [1615, 1703, 1763, 1823, 1879, 1938, 1997, 2056, 2114, 2174, 2233, 2290, 2350, 2407, 2467],
    2665: [1647, 1739, 1799, 1862, 1922, 1984, 2045, 2104, 2168, 2228, 2289, 2351, 2411, 2472, 2535],
    2790: [1680, 1775, 1839, 1901, 1965, 2030, 2092, 2156, 2220, 2283, 2347, 2410, 2474, 2538, 2600],
    2915: [1712, 1809, 1875, 1943, 2006, 2073, 2141, 2205, 2271, 2337, 2403, 2470, 2536, 2601, 2668]
}
    },
    
    // Griglia Prezzi Ante Slim-line
    prezziAnteSlimline: {
colonne: [990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740],
prezzi: {
    1230: [1486, 1528, 1565, 1605, 1644, 1684, 1724, 1764, 1800, 1841, 1880, 1920, 1959, 1998, 2040],
    1415: [1556, 1598, 1641, 1683, 1729, 1771, 1814, 1856, 1899, 1943, 1985, 2028, 2071, 2114, 2157],
    1605: [1627, 1672, 1721, 1766, 1813, 1860, 1904, 1952, 1999, 2046, 2093, 2140, 2186, 2233, 2279],
    1790: [1694, 1745, 1794, 1846, 1894, 1947, 1996, 2047, 2096, 2148, 2196, 2248, 2297, 2349, 2398],
    1980: [1765, 1819, 1874, 1928, 1980, 2035, 2088, 2143, 2196, 2250, 2304, 2359, 2411, 2467, 2520],
    2165: [1834, 1891, 1949, 2005, 2063, 2121, 2179, 2236, 2293, 2351, 2408, 2467, 2525, 2582, 2640],
    2355: [1903, 1965, 2026, 2087, 2150, 2209, 2271, 2333, 2393, 2456, 2515, 2578, 2639, 2701, 2761],
    2540: [2034, 2097, 2163, 2228, 2292, 2358, 2423, 2487, 2553, 2617, 2682, 2747, 2812, 2876, 2942],
    2730: [2106, 2176, 2245, 2311, 2381, 2449, 2516, 2586, 2655, 2722, 2793, 2862, 2928, 2998, 3066],
    2915: [2178, 2251, 2322, 2394, 2467, 2539, 2610, 2683, 2755, 2827, 2899, 2972, 3044, 3115, 3189]
}
    },
    
    // Supplementi Ferramenta FIN-Slide
    supplementiFerramenta: {
'83': { desc: 'Standard â‰¤250kg', prezzo: 0 },
'83F': { desc: 'Con stopper â‰¤250kg', prezzo: 12.2 },
'83.3': { desc: 'Sicurezza â‰¤250kg', prezzo: 79.6 },
'183': { desc: 'Pesante >250kg', prezzo: 95.7 },
'183.3': { desc: 'Pesante sicurezza', prezzo: 175.3 },
'84': { desc: 'Seconda anta â‰¤250kg', prezzo: 0 },
'84.3': { desc: 'Seconda anta sicur.', prezzo: 79.6 },
'184': { desc: 'Seconda pesante', prezzo: 95.7 },
'184.3': { desc: 'Seconda pesante sic.', prezzo: 175.3 },
'ST': { desc: 'Soft-Stop', prezzo: 143 }
    },
    
    // ğŸ†• v8.479: Maniglie FIN-Slide (listino EUR 2025/10 pag.68-79)
    maniglie: {
// Serie 2 - Alluminio (piÃ¹ comune)
'serie2': {
    descrizione: 'Maniglia alluminio serie 2',
    prezzi: {
        'M01': 166,      // bianco opaco
        '07': 166,       // bianco perla verniciato
        '56': 166,       // neutro anodizzato
        '74': 166,       // colore bronzo
        '79': 166,       // colore titanio
        'M03': 166,      // nero opaco
        '0156': 166,     // bianco neutro anodizzato
        '0174': 166      // bianco colore bronzo
    },
    default: 166
},
// Serie 3 - Acciaio inox
'serie3': {
    descrizione: 'Maniglia acciaio inox serie 3',
    prezzi: {
        '3S2': 167       // acciaio inox
    },
    default: 167
},
// Serie 11
'serie11': {
    descrizione: 'Maniglia serie 11',
    prezzi: {
        '56': 128,
        'E03': 128,
        '43': 317
    },
    default: 128
},
// Serie 12
'serie12': {
    descrizione: 'Maniglia serie 12',
    prezzi: {
        '43': 1249,
        '56': 594,
        'E03': 850
    },
    default: 594
}
    },
    
    // ğŸ†• v8.480: Vetri FIN-Slide (listino EUR 2025/10 pag.87-99)
    // Prezzi supplemento per mÂ² - Preisschema 2 (calcolo vetri VSG)
    vetri: {
// Max-Valor 3 con Multiprotect (triplo vetro 46mm) - piÃ¹ comune per HST
'Max-Valor3_46': {
    descrizione: 'Max-Valor 3 Multiprotect 46mm',
    codici: {
        '11429': { struttura: '33.1m-14-4F-13-44.2m', prezzoMq: 145, antieffrazione: 'P2A' },
        '12429': { struttura: '44.2m-12-4F-12-44.2m', prezzoMq: 176, antieffrazione: 'P2A' },
        '12439': { struttura: '44.2m-12-4F-12-44.4m', prezzoMq: 202, antieffrazione: 'P4A' }
    },
    default: 145  // Prezzo base anta
},
// Max-Valor 3 standard (triplo vetro 40mm)
'Max-Valor3_40': {
    descrizione: 'Max-Valor 3 Multiprotect 40mm',
    codici: {
        '114F4': { struttura: '33.1m-12-4F-13-4Tm', prezzoMq: 103 },
        '124F4': { struttura: '44.2m-10-4F-13-4Tm', prezzoMq: 135, antieffrazione: 'P2A' },
        '134F4': { struttura: '44.4m-10-4F-12-4Tm', prezzoMq: 159, antieffrazione: 'P4A' }
    },
    default: 103
},
// Plus-Valor 2 (doppio vetro) - piÃ¹ economico
'Plus-Valor2': {
    descrizione: 'Plus-Valor 2 (doppio)',
    default: 0  // Incluso nel prezzo base
}
    },
    
    // Funzione calcolo prezzo telaio
    // ğŸ†• v8.483: Calcolo prezzo telaio con supplementi corretti
    calcolaPrezzoTelaio: function(tipoTelaio, L, H) {
// Determina griglia prezzi in base al tipo telaio
// 90M, 90N, 090A0 â†’ usano griglia telaio 90 (base ALU-PVC 168)
// 38B, 38C â†’ usano griglia telaio 38 (base ALU-PVC 157)
const usaGriglia90 = ['90M', '90N', '090A0', '90', '090'].includes(tipoTelaio);
const griglia = usaGriglia90 ? this.prezziTelaio90 : this.prezziTelaio38;
if (!griglia) return 0;

const colIdx = griglia.colonne.findIndex(c => c >= L);
const idxL = colIdx >= 0 ? colIdx : griglia.colonne.length - 1;
const altDisp = Object.keys(griglia.prezzi).map(Number).sort((a,b) => a-b);
const rigaA = altDisp.find(a => a >= H) || altDisp[altDisp.length - 1];

const prezzoBase = griglia.prezzi[rigaA]?.[idxL] || 0;

// Calcola supplemento per metro lineare (perimetro telaio)
const perimetroM = ((L * 2) + (H * 2)) / 1000;
const supplementoMl = this.telai[tipoTelaio]?.supplementoMl || 0;
const supplementoTelaio = Math.round(perimetroM * supplementoMl * 100) / 100;

console.log(`ğŸ”§ Telaio ${tipoTelaio}: base â‚¬${prezzoBase} + suppl. ${perimetroM.toFixed(2)}ml Ã— â‚¬${supplementoMl}/ml = â‚¬${supplementoTelaio}`);

return prezzoBase + supplementoTelaio;
    },
    
    // Funzione calcolo prezzo anta
    calcolaPrezzoAnta: function(tipoAnta, L, H) {
const griglia = (tipoAnta === 'Step-line Door' || tipoAnta === 'Step-line') 
    ? this.prezziAnteStepline 
    : this.prezziAnteSlimline;
if (!griglia) return 0;

const colIdx = griglia.colonne.findIndex(c => c >= L);
const idxL = colIdx >= 0 ? colIdx : griglia.colonne.length - 1;
const altDisp = Object.keys(griglia.prezzi).map(Number).sort((a,b) => a-b);
const rigaA = altDisp.find(a => a >= H) || altDisp[altDisp.length - 1];

return griglia.prezzi[rigaA]?.[idxL] || 0;
    },
    
    // Funzione calcolo completo FIN-Slide
    calcolaPrezzoFinSlide: function(config) {
const { tipoTelaio, tipoAnta, L, H, ferramenta, numAnte = 1 } = config;

const prezzoTelaio = this.calcolaPrezzoTelaio(tipoTelaio, L, H);
const prezzoAntaUnitario = this.calcolaPrezzoAnta(tipoAnta, L / numAnte, H);
const prezzoAnte = prezzoAntaUnitario * numAnte;
const supplFerramenta = this.supplementiFerramenta[ferramenta]?.prezzo || 0;

return {
    prezzoTelaio,
    prezzoAnte,
    supplFerramenta,
    totale: prezzoTelaio + prezzoAnte + supplFerramenta
};
    }
};

console.log('ğŸ  FIN-SLIDE Database caricato - Dashboard v8.469');

// ============================================================================
// ğŸ†• v8.44: DATABASE FINSTRAL OTTOBRE 2025
// ============================================================================

// BANCALI INTERNI (listino 10/2025 pag. 140)
window.FINSTRAL_BANCALI_INTERNI = {
    'PVC': {
codice: '25000',
desc: 'MDF pellicolato 25mm',
note: 'Lunghezza max 4400mm. Oltre 3200mm: 2 pezzi con giunzione',
profondita: [120, 150, 180, 200, 240, 280, 320, 360, 400],
lunghezze: [600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800, 4000, 4200, 4400],
prezzi: [
    [22.2, 24.6, 26.6, 29.1, 31.8, 34.4, 36.4, 39.1, 41.6, 67.9, 70.6, 73.5, 76.2, 78.7, 83.4, 87.9, 90.5, 93.2, 95.4, 100],
    [24.5, 27.2, 29.1, 32.0, 34.5, 37.4, 39.6, 42.4, 45.7, 75.9, 78.8, 82.1, 84.9, 88.4, 93.9, 98.3, 102, 105, 108, 112],
    [29.2, 32.5, 35.1, 37.9, 40.8, 43.9, 47.1, 50.2, 53.8, 89.7, 93.0, 96.7, 100, 104, 110, 115, 119, 123, 127, 131],
    [31.5, 35.2, 37.8, 40.8, 44.0, 47.2, 50.8, 54.2, 57.9, 96.9, 100, 104, 108, 113, 119, 125, 129, 134, 138, 143],
    [38.7, 42.8, 46.0, 50.2, 54.3, 58.1, 62.9, 66.6, 71.1, 119, 123, 128, 133, 139, 147, 154, 159, 165, 170, 177],
    [43.1, 47.9, 51.7, 56.2, 60.4, 65.2, 70.1, 74.8, 79.7, 133, 138, 144, 149, 155, 163, 172, 178, 185, 191, 197],
    [50.5, 55.7, 60.3, 73.0, 76.8, 82.1, 91.3, 96.4, 100, 141, 146, 150, 155, 161, 171, 184, 188, 191, 196, 203],
    [55.5, 61.7, 66.9, 80.6, 85.1, 91.1, 101, 107, 111, 157, 162, 167, 173, 179, 190, 204, 209, 213, 218, 226],
    [60.3, 67.8, 76.8, 90.0, 96.4, 105, 120, 125, 134, 179, 186, 193, 202, 211, 222, 236, 245, 253, 261, 268]
]
    },
    'LEGNO_95000': {
codice: '95000',
desc: 'Legno 19mm profilo 39mm',
note: 'Lunghezza max 3200mm',
profondita: [120, 150, 180, 200, 240, 280, 320, 360, 400],
lunghezze: [600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200],
prezzi: [
    [42.8, 48.7, 54.5, 60.3, 66.2, 72.0, 77.8, 83.7, 89.5, 95.4, 101, 107, 113, 119],
    [45.9, 52.3, 58.6, 65.0, 71.4, 77.7, 84.1, 90.4, 96.8, 103, 110, 116, 122, 129],
    [49.0, 55.8, 62.7, 69.6, 76.5, 83.4, 90.3, 97.2, 104, 111, 118, 125, 132, 139],
    [50.5, 57.6, 64.7, 71.9, 79.0, 86.1, 93.3, 100, 108, 115, 122, 129, 136, 143],
    [53.6, 61.2, 68.8, 76.5, 84.1, 91.7, 99.4, 107, 115, 122, 130, 137, 145, 153],
    [56.7, 64.8, 72.9, 81.1, 89.2, 97.4, 106, 114, 122, 130, 138, 146, 154, 163],
    [59.7, 68.4, 77.0, 85.7, 94.3, 103, 112, 120, 129, 138, 146, 155, 164, 172],
    [62.8, 72.0, 81.1, 90.3, 99.4, 109, 118, 127, 136, 146, 155, 164, 173, 182],
    [65.9, 75.5, 85.2, 94.8, 104, 114, 124, 133, 143, 153, 163, 172, 182, 192]
]
    },
    'LEGNO_96000': {
codice: '96000',
desc: 'Legno 19mm profilo 69mm',
note: 'Lunghezza max 4400mm. Oltre 3200mm: 2 pezzi con giunzione',
profondita: [120, 150, 180, 200, 240, 280, 320, 360, 400],
lunghezze: [600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800, 4000, 4200, 4400],
prezzi: [
    [53.9, 61.7, 69.4, 77.2, 85.0, 92.8, 101, 108, 116, 124, 132, 139, 147, 155, 163, 170, 178, 186, 194, 201],
    [57.9, 66.3, 74.7, 83.2, 91.6, 100, 108, 117, 125, 134, 142, 151, 159, 167, 176, 184, 193, 201, 209, 218],
    [61.9, 71.0, 80.1, 89.1, 98.2, 107, 116, 125, 134, 143, 153, 162, 171, 180, 189, 198, 207, 217, 226, 235],
    [63.9, 73.3, 82.7, 92.2, 102, 111, 120, 130, 139, 149, 158, 168, 177, 186, 196, 205, 215, 224, 234, 243],
    [67.9, 78.0, 88.1, 98.2, 108, 118, 129, 139, 149, 159, 169, 179, 190, 200, 210, 220, 230, 240, 250, 260],
    [71.9, 82.6, 93.4, 104, 115, 126, 137, 147, 158, 169, 180, 191, 202, 213, 224, 234, 245, 256, 267, 278],
    [75.9, 87.3, 98.7, 110, 122, 133, 145, 156, 168, 179, 191, 202, 214, 226, 237, 249, 260, 272, 284, 295],
    [79.9, 92.0, 104, 116, 128, 141, 153, 165, 177, 189, 202, 214, 226, 238, 251, 263, 275, 288, 300, 312],
    [83.9, 96.6, 109, 122, 135, 148, 161, 174, 187, 200, 213, 225, 238, 251, 264, 277, 290, 303, 316, 329]
]
    }
};

// ANTA TWIN - Veneziana e Plissettata (listino 10/2025 pag. 146-147)
window.FINSTRAL_ANTA_TWIN = {
    tipiAnta: {
'SLIM_TWIN': { cod: 'C788', desc: 'Slim-line Twin 77mm', codVeneziana: 'WS25' },
'SLIM_TWIN_90': { cod: 'C988', desc: 'Slim-line Twin 90/124mm', codVeneziana: 'WS25' },
'SLIM_CRISTAL_TWIN': { cod: 'C779', desc: 'Slim-line Cristal Twin', codVeneziana: 'WSC25' },
'SLIM_CRISTAL_TWIN_90': { cod: 'C979', desc: 'Slim-line Cristal Twin 90/124', codVeneziana: 'WSC25' },
'NOVA_TWIN': { cod: 'N989', desc: 'Nova-line Twin', codVeneziana: 'WN25' },
'NOVA_CRISTAL_TWIN': { cod: 'N979', desc: 'Nova-line Cristal Twin', codVeneziana: 'WNC25' }
    },
    coloriVeneziana: {
'0717': { nome: 'Silver', gtot: 0.09, classe: 4, riflessione: 64, trasmissione: 4, assorbimento: 32 },
'0716': { nome: 'Dark silver', gtot: 0.13, classe: 3, riflessione: 51, trasmissione: 2, assorbimento: 47 },
'0710': { nome: 'White', gtot: 0.26, classe: 2, riflessione: 63, trasmissione: 17, assorbimento: 20 },
'0711': { nome: 'Cream', gtot: 0.28, classe: 2, riflessione: 57, trasmissione: 17, assorbimento: 26 },
'0715': { nome: 'Grey', gtot: 0.18, classe: 2, riflessione: 39, trasmissione: 4, assorbimento: 57 },
'0703': { nome: 'Brown', gtot: 0.21, classe: 2, riflessione: 26, trasmissione: 4, assorbimento: 70 },
'0750': { nome: 'Black', gtot: 0.20, classe: 2, riflessione: 6, trasmissione: 2, assorbimento: 92 },
'0719': { nome: 'Gold mink', gtot: 0.19, classe: 2, riflessione: 38, trasmissione: 6, assorbimento: 56 },
'0620': { nome: 'Silver (lamella larga)', gtot: 0.10, classe: 4, riflessione: 65, trasmissione: 5, assorbimento: 30 }
    },
    coloriPlissettata: {
'7460': { nome: 'White', gtot: 0.07, classe: 4, riflessione: 70, trasmissione: 0, assorbimento: 30 },
'7461': { nome: 'Cream', gtot: 0.07, classe: 4, riflessione: 70, trasmissione: 0, assorbimento: 30 },
'7466': { nome: 'Grey', gtot: 0.07, classe: 4, riflessione: 70, trasmissione: 0, assorbimento: 30 },
'7467': { nome: 'Grigio scuro', gtot: 0.07, classe: 4, riflessione: 70, trasmissione: 0, assorbimento: 30 }
    },
    comandi: {
'27': { desc: 'Catenella', supplemento: 0 },
'30': { desc: 'Motore 2.5m', supplemento: 345 },
'30-1': { desc: 'Motore 10m', supplemento: 356 }
    },
    // Prezzi veneziana (larghezze x altezze)
    prezziVeneziana: {
larghezze: [400, 500, 600, 700, 800, 900, 1000, 1100],
altezze: [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300],
prezzi: [
    [141, 150, 159, 168, 177, 186, 195, 205],
    [148, 158, 168, 178, 188, 198, 209, 219],
    [155, 166, 177, 188, 199, 211, 222, 233],
    [162, 174, 186, 198, 210, 223, 235, 248],
    [169, 182, 195, 208, 221, 235, 248, 262],
    [176, 190, 204, 218, 232, 247, 261, 276],
    [183, 198, 213, 228, 243, 259, 274, 290],
    [190, 206, 222, 238, 255, 271, 288, 304],
    [197, 214, 231, 248, 266, 283, 301, 319],
    [205, 223, 241, 259, 277, 296, 314, 333],
    [212, 231, 250, 269, 288, 308, 327, 347],
    [219, 239, 259, 279, 299, 320, 341, 361],
    [226, 247, 268, 289, 310, 332, 354, 376],
    [233, 255, 277, 299, 322, 344, 367, 390],
    [240, 263, 286, 309, 333, 357, 380, 404],
    [248, 272, 296, 320, 344, 369, 394, 419],
    [255, 280, 305, 330, 355, 381, 407, 433],
    [262, 288, 314, 340, 366, 393, 420, 447]
]
    },
    // Prezzi plissettata
    prezziPlissettata: {
larghezze: [400, 500, 600, 700, 800, 900, 1000, 1100],
altezze: [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300],
prezzi: [
    [155, 165, 175, 185, 195, 205, 215, 225],
    [163, 174, 185, 196, 207, 218, 229, 241],
    [171, 183, 195, 207, 219, 232, 244, 257],
    [179, 192, 205, 218, 232, 245, 259, 273],
    [187, 201, 215, 229, 244, 259, 273, 288],
    [195, 210, 225, 240, 256, 272, 288, 304],
    [203, 219, 235, 251, 268, 285, 302, 320],
    [211, 228, 245, 262, 281, 299, 317, 336],
    [219, 237, 255, 274, 293, 312, 332, 352],
    [227, 246, 265, 285, 305, 326, 346, 368],
    [235, 255, 276, 296, 318, 339, 361, 383],
    [243, 264, 286, 307, 330, 352, 375, 399],
    [251, 274, 296, 319, 342, 366, 390, 415],
    [259, 283, 306, 330, 355, 379, 405, 431],
    [267, 292, 316, 341, 367, 393, 419, 446],
    [275, 301, 326, 352, 379, 406, 434, 462],
    [283, 310, 337, 364, 391, 420, 448, 478],
    [291, 319, 347, 375, 404, 433, 463, 493]
]
    }
};

// PROFILI ALLARGAMENTO (listino 10/2025 pag. 64-82)
window.FINSTRAL_ALLARGAMENTI = {
    'PVC_77': {
codSenzaRinforzo: '1Q1',
codConRinforzo: '1QX1',
desc: 'Allargamento 77mm PVC-PVC',
misure: {
    30: { senzaRinf: 19.1, conRinf: 25.9, raggio: 400 },
    50: { senzaRinf: 21.5, conRinf: 28.3, raggio: 450 },
    80: { senzaRinf: 45.6 },
    100: { senzaRinf: 45.6 },
    150: { senzaRinf: 45.6 },
    200: { senzaRinf: 67.1 },
    250: { senzaRinf: 91.2 },
    300: { senzaRinf: 91.2 }
}
    },
    'PVC_LEGNO_77': {
codice: '4GAC',
desc: 'Allargamento 77mm PVC-Legno',
note: 'Prezzi variano per gruppo colore PVC e legno',
misure: {
    30: { gruppoA_legno1: 65.2, gruppoB_legno1: 66.9 },
    50: { gruppoA_legno1: 70.3, gruppoB_legno1: 72.9 },
    80: { gruppoA_legno1: 135, gruppoB_legno1: 140 },
    100: { gruppoA_legno1: 141, gruppoB_legno1: 146 },
    150: { gruppoA_legno1: 211, gruppoB_legno1: 219 }
}
    },
    'PVC_ALU_77': {
codice: '2GAC',
desc: 'Allargamento 77mm PVC-Alluminio',
misure: {
    30: { gruppoA: 60.4, gruppoB: 62.1 },
    50: { gruppoA: 66.2, gruppoB: 68.9 },
    80: { gruppoA: 109, gruppoB: 114 },
    100: { gruppoA: 115, gruppoB: 121 },
    150: { gruppoA: 164, gruppoB: 172 }
}
    }
};

// Funzione calcolo prezzo bancale interno
window.calcolaPrezzoBancaleInterno = function(tipo, profondita, lunghezza) {
    const bancale = FINSTRAL_BANCALI_INTERNI[tipo];
    if (!bancale) return 0;
    
    // Trova indice profonditÃ 
    let idxP = 0;
    for (let i = 0; i < bancale.profondita.length; i++) {
if (profondita <= bancale.profondita[i]) { idxP = i; break; }
idxP = i;
    }
    
    // Trova indice lunghezza
    let idxL = 0;
    for (let i = 0; i < bancale.lunghezze.length; i++) {
if (lunghezza <= bancale.lunghezze[i]) { idxL = i; break; }
idxL = i;
    }
    
    return bancale.prezzi[idxP]?.[idxL] || 0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.509: FUNZIONE CENTRALIZZATA CALCOLO BRM CON FALLBACK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Calcola BRM con fallback automatico da misure vano quando BRM Ã¨ null/vuoto
 * 
 * REGOLA FALLBACK (definita insieme):
 * - Se BRM_L/BRM_H esistono â†’ usa quelli
 * - Altrimenti usa misure vano con questi offset:
 *   - LF/HF (Luce Foro): +100mm / +50mm
 *   - LVT/HVT (Luce Vano Totale): +100mm / +50mm
 *   - TMV/HMT (Telaio Muratura Vano): -40mm / -20mm
 * 
 * PRIORITÃ€: BRM â†’ LF/HF â†’ LVT/HVT â†’ TMV/HMT
 * 
 * @param {Object} config - Configurazione con BRM e/o misure
 * @param {number} config.BRM_L - Larghezza BRM (se presente)
 * @param {number} config.BRM_H - Altezza BRM (se presente)
 * @param {Object} config.misure - Oggetto misure vano (opzionale)
 * @param {number} config.misure.LF - Luce Foro larghezza
 * @param {number} config.misure.HF - Altezza Foro
 * @param {number} config.misure.LVT - Luce Vano Totale larghezza
 * @param {number} config.misure.HVT - Altezza Vano Totale
 * @param {number} config.misure.TMV - Telaio Muratura Vano larghezza
 * @param {number} config.misure.HMT - Altezza Muratura Telaio
 * @returns {Object} { L: number, H: number, source: string }
 */
window.getBRMConFallback = function(config) {
    const { BRM_L, BRM_H, misure } = config;
    
    // 1. Se BRM giÃ  presente, usalo
    if (BRM_L && BRM_H) {
        return { 
            L: parseInt(BRM_L), 
            H: parseInt(BRM_H), 
            source: 'BRM diretto'
        };
    }
    
    if (!misure) {
        console.warn('âš ï¸ getBRMConFallback: nÃ© BRM nÃ© misure disponibili!');
        return { L: 0, H: 0, source: 'nessuno' };
    }
    
    // 2. Fallback LF/HF (Luce Foro) - PRIORITÃ€ 1
    if (misure.LF && misure.HF) {
        const L = parseInt(misure.LF) + 100;
        const H = parseInt(misure.HF) + 50;
        console.log(`ğŸ“ BRM calcolato da LF/HF: ${L}Ã—${H} (LF=${misure.LF} +100, HF=${misure.HF} +50)`);
        return { L, H, source: 'LF/HF +100/+50' };
    }
    
    // 3. Fallback LVT/HVT (Luce Vano Totale) - PRIORITÃ€ 2
    if (misure.LVT && misure.HVT) {
        const L = parseInt(misure.LVT) + 100;
        const H = parseInt(misure.HVT) + 50;
        console.log(`ğŸ“ BRM calcolato da LVT/HVT: ${L}Ã—${H} (LVT=${misure.LVT} +100, HVT=${misure.HVT} +50)`);
        return { L, H, source: 'LVT/HVT +100/+50' };
    }
    
    // 4. Fallback TMV/HMT (Telaio Muratura) - PRIORITÃ€ 3
    if (misure.TMV && misure.HMT) {
        const L = parseInt(misure.TMV) - 40;
        const H = parseInt(misure.HMT) - 20;
        console.log(`ğŸ“ BRM calcolato da TMV/HMT: ${L}Ã—${H} (TMV=${misure.TMV} -40, HMT=${misure.HMT} -20)`);
        return { L, H, source: 'TMV/HMT -40/-20' };
    }
    
    // 5. Nessuna misura utilizzabile
    console.warn('âš ï¸ getBRMConFallback: nessuna misura valida trovata!');
    return { L: 0, H: 0, source: 'nessuno' };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.509: HELPER CONVERSIONE MODELLO TWIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Converte chiave interna modello Twin â†’ descrizione completa
 * 
 * @param {string} modelKey - Chiave interna (es. "SLIM_TWIN", "NOVA_TWIN")
 * @returns {string} Descrizione completa (es. "C788 - Slim-line Twin 77mm")
 * 
 * @example
 * getTwinModelDescription("SLIM_TWIN") â†’ "C788 - Slim-line Twin 77mm"
 * getTwinModelDescription("NOVA_TWIN") â†’ "N989 - Nova-line Twin"
 */
window.getTwinModelDescription = function(modelKey) {
    if (!modelKey) return '';
    
    if (typeof FINSTRAL_ANTA_TWIN === 'undefined') {
        console.warn('âš ï¸ FINSTRAL_ANTA_TWIN non caricato!');
        return modelKey;
    }
    
    const model = FINSTRAL_ANTA_TWIN.tipiAnta[modelKey];
    
    if (model) {
        return `${model.cod} - ${model.desc}`;
    }
    
    // Fallback: ritorna chiave se non trovata
    console.warn(`âš ï¸ Modello Twin "${modelKey}" non trovato in database`);
    return modelKey;
};

/**
 * Converte descrizione completa â†’ chiave interna (reverse)
 * 
 * @param {string} description - Descrizione (es. "C788 - Slim-line Twin 77mm")
 * @returns {string} Chiave interna (es. "SLIM_TWIN")
 * 
 * @example
 * getTwinModelKey("C788 - Slim-line Twin 77mm") â†’ "SLIM_TWIN"
 */
window.getTwinModelKey = function(description) {
    if (!description) return '';
    
    if (typeof FINSTRAL_ANTA_TWIN === 'undefined') {
        return description;
    }
    
    // Estrae codice dalla descrizione (es. "C788" da "C788 - Slim-line Twin 77mm")
    const codice = description.split(' - ')[0].trim();
    
    // Cerca modello per codice
    for (const [key, model] of Object.entries(FINSTRAL_ANTA_TWIN.tipiAnta)) {
        if (model.cod === codice) {
            return key;
        }
    }
    
    // Fallback: ritorna descrizione
    return description;
};

// Funzione calcolo prezzo anta twin
window.calcolaPrezzoAntaTwin = function(tipoOscurante, larghezza, altezza, comando = '27') {
    const tabella = tipoOscurante === 'veneziana' ? 
FINSTRAL_ANTA_TWIN.prezziVeneziana : 
FINSTRAL_ANTA_TWIN.prezziPlissettata;
    
    // Trova indice larghezza
    let idxL = 0;
    for (let i = 0; i < tabella.larghezze.length; i++) {
if (larghezza <= tabella.larghezze[i]) { idxL = i; break; }
idxL = i;
    }
    
    // Trova indice altezza
    let idxA = 0;
    for (let i = 0; i < tabella.altezze.length; i++) {
if (altezza <= tabella.altezze[i]) { idxA = i; break; }
idxA = i;
    }
    
    let prezzo = tabella.prezzi[idxA]?.[idxL] || 0;
    
    // Aggiungi supplemento comando
    const supplComando = FINSTRAL_ANTA_TWIN.comandi[comando]?.supplemento || 0;
    
    return prezzo + supplComando;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… v8.468: SISTEMA VALIDAZIONE PREVENTIVI
// Valida i dati di ogni prodotto prima del calcolo prezzo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * SCHEMA VALIDAZIONE INFISSI FINSTRAL
 * Definisce quali campi sono necessari e a che livello
 */
window.SCHEMA_VALIDAZIONE = {
    infisso: {
nome: "Infisso Finstral",
campi: {
    // ğŸ”´ CRITICI - senza questi NO calcolo
    BRM_L: { 
        livello: 'critico', 
        label: 'Larghezza BRM',
        messaggio: 'Misura larghezza mancante',
        default: null 
    },
    BRM_H: { 
        livello: 'critico', 
        label: 'Altezza BRM',
        messaggio: 'Misura altezza mancante',
        default: null 
    },
    codiceModello: { 
        livello: 'critico', 
        label: 'Tipo/Modello',
        messaggio: 'Codice modello Finstral mancante (101, 401, 420, 500...)',
        default: null,
        valoriValidi: ['101', '102', '301', '401', '420', '421', '500', '501', '503', '504', '505', '510', '511', '513', '514']
    },
    
    // ğŸŸ  NECESSARI - warning + default, errore 5-15%
    telaio: { 
        livello: 'necessario', 
        label: 'Telaio',
        messaggio: 'Telaio non specificato',
        default: '961',
        margineErrore: 5
    },
    tipoAnta: { 
        livello: 'necessario', 
        label: 'Tipo Anta',
        messaggio: 'Tipo anta non specificato',
        default: 'step-line',
        margineErrore: 8
    },
    ferramenta1: { 
        livello: 'necessario', 
        label: 'Ferramenta',
        messaggio: 'Ferramenta non specificata',
        default: '411',
        margineErrore: 5
    },
    finituraEst: { 
        livello: 'necessario', 
        label: 'Finitura Esterna',
        messaggio: 'Finitura esterna non specificata',
        default: 'pvc',
        margineErrore: 10
    },
    
    // ğŸŸ¡ IMPORTANTI - info + default, errore 2-5%
    coloreEst: { 
        livello: 'importante', 
        label: 'Colore Esterno',
        messaggio: 'Colore esterno non specificato',
        default: '42 - Bianco',
        margineErrore: 3
    },
    coloreInt: { 
        livello: 'importante', 
        label: 'Colore Interno',
        messaggio: 'Colore interno non specificato',
        default: '42 - Bianco',
        margineErrore: 2
    },
    vetro: { 
        livello: 'importante', 
        label: 'Vetro',
        messaggio: 'Tipo vetro non specificato',
        default: 'standard',
        margineErrore: 5
    },
    maniglia: { 
        livello: 'importante', 
        label: 'Maniglia',
        messaggio: 'Maniglia non specificata',
        default: 'standard',
        margineErrore: 1
    },
    
    // ğŸŸ¢ OPZIONALI - nessun problema se mancano
    tagliTelaio: { livello: 'opzionale', label: 'Tagli Telaio', default: null },
    codTagliValues: { livello: 'opzionale', label: 'Codici Taglio', default: [] },
    allarme: { livello: 'opzionale', label: 'Allarme', default: 'no' },
    cerniere: { livello: 'opzionale', label: 'Cerniere', default: 'a-vista' }
}
    },
    
    persiana: {
nome: "Persiana",
campi: {
    BRM_L: { livello: 'critico', label: 'Larghezza', messaggio: 'Larghezza mancante', default: null },
    BRM_H: { livello: 'critico', label: 'Altezza', messaggio: 'Altezza mancante', default: null },
    azienda: { livello: 'necessario', label: 'Azienda', messaggio: 'Azienda non specificata', default: 'Punto Persiane', margineErrore: 10 },
    modello: { livello: 'necessario', label: 'Modello', messaggio: 'Modello non specificato', default: null, margineErrore: 15 },
    numAnte: { livello: 'importante', label: 'Numero Ante', messaggio: 'Numero ante non specificato', default: '2', margineErrore: 5 },
    colore: { livello: 'importante', label: 'Colore', messaggio: 'Colore non specificato', default: 'RAL 9010', margineErrore: 3 }
}
    },
    
    tapparella: {
nome: "Tapparella",
campi: {
    larghezza: { livello: 'critico', label: 'Larghezza', messaggio: 'Larghezza mancante', default: null },
    altezza: { livello: 'critico', label: 'Altezza', messaggio: 'Altezza mancante', default: null },
    azienda: { livello: 'necessario', label: 'Azienda', messaggio: 'Azienda non specificata', default: 'Plasticino', margineErrore: 5 },
    modello: { livello: 'necessario', label: 'Modello', messaggio: 'Modello non specificato', default: 'Mini', margineErrore: 10 },
    materiale: { livello: 'importante', label: 'Materiale', messaggio: 'Materiale non specificato', default: 'PVC', margineErrore: 5 }
}
    },
    
    cassonetto: {
nome: "Cassonetto",
campi: {
    larghezza: { livello: 'critico', label: 'Larghezza', messaggio: 'Larghezza mancante', default: null },
    tipo: { livello: 'necessario', label: 'Tipo', messaggio: 'Tipo cassonetto non specificato', default: 'standard', margineErrore: 10 }
}
    },
    
    motore: {
nome: "Motore Somfy",
campi: {
    modello: { livello: 'critico', label: 'Modello', messaggio: 'Modello motore mancante', default: null },
    larghezzaTapparella: { livello: 'importante', label: 'Larghezza Tapparella', messaggio: 'Larghezza per calcolo coppia', default: 1500, margineErrore: 5 }
}
    }
};

/**
 * Valida un prodotto secondo lo schema
 * @param {string} tipoProdotto - 'infisso', 'persiana', 'tapparella', etc.
 * @param {object} prodotto - Dati del prodotto da validare
 * @param {object} configGlobale - Configurazione globale (fallback)
 * @returns {object} { valido, errori[], warning[], info[], margineErrore, affidabilita }
 */
window.validaProdotto = function(tipoProdotto, prodotto, configGlobale = {}) {
    const schema = SCHEMA_VALIDAZIONE[tipoProdotto];
    if (!schema) {
return { 
    valido: false, 
    errori: [{campo: 'tipo', messaggio: `Schema validazione non trovato per: ${tipoProdotto}`}],
    warning: [],
    info: [],
    margineErrore: 100,
    affidabilita: 0
};
    }
    
    const risultato = {
valido: true,
errori: [],      // ğŸ”´ Critici
warning: [],     // ğŸŸ  Necessari mancanti
info: [],        // ğŸŸ¡ Importanti mancanti
defaultUsati: [], // Campi dove Ã¨ stato usato il default
margineErrore: 0,
affidabilita: 100
    };
    
    // Controlla ogni campo dello schema
    for (const [nomeCampo, config] of Object.entries(schema.campi)) {
// Cerca valore nel prodotto o nella config globale
let valore = prodotto?.[nomeCampo];
if (valore === undefined || valore === null || valore === '') {
    // Prova config globale
    valore = configGlobale?.[nomeCampo];
}

const mancante = (valore === undefined || valore === null || valore === '');

if (mancante) {
    const item = {
        campo: nomeCampo,
        label: config.label,
        messaggio: config.messaggio || `${config.label} mancante`,
        default: config.default,
        margineErrore: config.margineErrore || 0
    };
    
    switch (config.livello) {
        case 'critico':
            risultato.errori.push(item);
            risultato.valido = false;
            risultato.affidabilita = 0;
            break;
            
        case 'necessario':
            risultato.warning.push(item);
            risultato.margineErrore += item.margineErrore;
            if (config.default !== null) {
                risultato.defaultUsati.push({
                    campo: nomeCampo,
                    label: config.label,
                    valore: config.default
                });
            }
            break;
            
        case 'importante':
            risultato.info.push(item);
            risultato.margineErrore += item.margineErrore;
            if (config.default !== null) {
                risultato.defaultUsati.push({
                    campo: nomeCampo,
                    label: config.label,
                    valore: config.default
                });
            }
            break;
            
        // 'opzionale' non genera messaggi
    }
}

// Valida valore se presente e ci sono valori validi
if (!mancante && config.valoriValidi) {
    if (!config.valoriValidi.includes(String(valore))) {
        risultato.warning.push({
            campo: nomeCampo,
            label: config.label,
            messaggio: `${config.label} "${valore}" non riconosciuto`,
            valoreAttuale: valore,
            valoriValidi: config.valoriValidi
        });
    }
}
    }
    
    // Calcola affidabilitÃ 
    if (risultato.valido) {
risultato.affidabilita = Math.max(0, 100 - risultato.margineErrore);
    }
    
    // Stato complessivo
    if (risultato.errori.length > 0) {
risultato.stato = 'errore';
risultato.icona = 'ğŸ”´';
risultato.colore = '#dc2626';
    } else if (risultato.warning.length > 0) {
risultato.stato = 'warning';
risultato.icona = 'ğŸŸ ';
risultato.colore = '#f97316';
    } else if (risultato.info.length > 0) {
risultato.stato = 'info';
risultato.icona = 'ğŸŸ¡';
risultato.colore = '#eab308';
    } else {
risultato.stato = 'completo';
risultato.icona = 'âœ…';
risultato.colore = '#22c55e';
    }
    
    return risultato;
}

/**
 * Valida tutte le posizioni di un progetto
 * @param {array} positions - Array posizioni dal JSON
 * @param {object} configGlobale - Configurazioni globali
 * @returns {object} { riepilogo, dettagli[] }
 */
window.validaProgetto = function(positions, configGlobale = {}) {
    const risultato = {
totalePositioni: positions.length,
completi: 0,
conWarning: 0,
conErrori: 0,
dettagli: [],
affidabilitaMedia: 0
    };
    
    let sommaAffidabilita = 0;
    let contaProdotti = 0;
    
    positions.forEach((pos, index) => {
const posDetail = {
    posizione: index + 1,
    ambiente: pos.ambiente || `Pos ${index + 1}`,
    prodotti: []
};

// Valida Infisso
if (pos.infisso && (pos.infisso.qta > 0 || pos.infisso.BRM_L)) {
    const valInfisso = validaProdotto('infisso', pos.infisso, configGlobale.configInfissi);
    valInfisso.tipo = 'Infisso';
    posDetail.prodotti.push(valInfisso);
    sommaAffidabilita += valInfisso.affidabilita;
    contaProdotti++;
    
    if (valInfisso.stato === 'errore') risultato.conErrori++;
    else if (valInfisso.stato === 'warning') risultato.conWarning++;
    else risultato.completi++;
}

// Valida Persiana
if (pos.persiana && pos.persiana.servePersiana) {
    const valPersiana = validaProdotto('persiana', pos.persiana, configGlobale.configPersiane);
    valPersiana.tipo = 'Persiana';
    posDetail.prodotti.push(valPersiana);
    sommaAffidabilita += valPersiana.affidabilita;
    contaProdotti++;
}

// Valida Tapparella
if (pos.tapparella && pos.tapparella.serveTapparella) {
    const valTapp = validaProdotto('tapparella', pos.tapparella, configGlobale.configTapparelle);
    valTapp.tipo = 'Tapparella';
    posDetail.prodotti.push(valTapp);
    sommaAffidabilita += valTapp.affidabilita;
    contaProdotti++;
}

// Valida Cassonetto
if (pos.cassonetto && pos.cassonetto.qta > 0) {
    const valCass = validaProdotto('cassonetto', pos.cassonetto, configGlobale.configCassonetti);
    valCass.tipo = 'Cassonetto';
    posDetail.prodotti.push(valCass);
    sommaAffidabilita += valCass.affidabilita;
    contaProdotti++;
}

risultato.dettagli.push(posDetail);
    });
    
    risultato.affidabilitaMedia = contaProdotti > 0 ? 
Math.round(sommaAffidabilita / contaProdotti) : 100;
    
    return risultato;
}

/**
 * Genera HTML popup validazione
 */
window.generaHTMLValidazione = function(validazione) {
    const { totalePositioni, completi, conWarning, conErrori, dettagli, affidabilitaMedia } = validazione;
    
    // Colore affidabilitÃ 
    let coloreAff = '#22c55e';
    if (affidabilitaMedia < 70) coloreAff = '#dc2626';
    else if (affidabilitaMedia < 85) coloreAff = '#f97316';
    else if (affidabilitaMedia < 95) coloreAff = '#eab308';
    
    let html = `
    <div style="padding: 1.5rem; max-height: 70vh; overflow-y: auto;">
<!-- HEADER RIEPILOGO -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
    <div style="background: #f0fdf4; border: 2px solid #22c55e; border-radius: 0.5rem; padding: 1rem; text-align: center;">
        <div style="font-size: 2rem; font-weight: 700; color: #22c55e;">âœ… ${completi}</div>
        <div style="font-size: 0.875rem; color: #166534;">Completi</div>
    </div>
    <div style="background: #fff7ed; border: 2px solid #f97316; border-radius: 0.5rem; padding: 1rem; text-align: center;">
        <div style="font-size: 2rem; font-weight: 700; color: #f97316;">ğŸŸ  ${conWarning}</div>
        <div style="font-size: 0.875rem; color: #9a3412;">Warning</div>
    </div>
    <div style="background: #fef2f2; border: 2px solid #dc2626; border-radius: 0.5rem; padding: 1rem; text-align: center;">
        <div style="font-size: 2rem; font-weight: 700; color: #dc2626;">ğŸ”´ ${conErrori}</div>
        <div style="font-size: 0.875rem; color: #991b1b;">Errori</div>
    </div>
    <div style="background: #f8fafc; border: 2px solid ${coloreAff}; border-radius: 0.5rem; padding: 1rem; text-align: center;">
        <div style="font-size: 2rem; font-weight: 700; color: ${coloreAff};">${affidabilitaMedia}%</div>
        <div style="font-size: 0.875rem; color: #475569;">AffidabilitÃ </div>
    </div>
</div>
    `;
    
    // Dettaglio per posizione (solo se ci sono problemi)
    const posizioniConProblemi = dettagli.filter(d => 
d.prodotti.some(p => p.stato !== 'completo')
    );
    
    if (posizioniConProblemi.length > 0) {
html += `
<div style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem;">
    <h4 style="margin: 0 0 1rem 0; color: #374151;">ğŸ“‹ Dettaglio Problemi</h4>
`;

posizioniConProblemi.forEach(pos => {
    pos.prodotti.filter(p => p.stato !== 'completo').forEach(prod => {
        html += `
        <div style="background: white; border-left: 4px solid ${prod.colore}; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 0 0.25rem 0.25rem 0;">
            <div style="font-weight: 600; margin-bottom: 0.25rem;">
                ${prod.icona} Pos.${pos.posizione} ${pos.ambiente} - ${prod.tipo}
            </div>
        `;
        
        // Errori critici
        prod.errori?.forEach(err => {
            html += `<div style="color: #dc2626; font-size: 0.875rem; margin-left: 1rem;">ğŸ”´ ${err.messaggio}</div>`;
        });
        
        // Warning
        prod.warning?.forEach(warn => {
            html += `<div style="color: #f97316; font-size: 0.875rem; margin-left: 1rem;">ğŸŸ  ${warn.messaggio}${warn.default ? ` â†’ default: ${warn.default}` : ''}</div>`;
        });
        
        // Info
        prod.info?.forEach(info => {
            html += `<div style="color: #eab308; font-size: 0.875rem; margin-left: 1rem;">ğŸŸ¡ ${info.messaggio}${info.default ? ` â†’ default: ${info.default}` : ''}</div>`;
        });
        
        if (prod.affidabilita < 100) {
            html += `<div style="color: #6b7280; font-size: 0.75rem; margin-left: 1rem; margin-top: 0.25rem;">ğŸ“ˆ AffidabilitÃ : ${prod.affidabilita}% (margine errore Â±${prod.margineErrore}%)</div>`;
        }
        
        html += `</div>`;
    });
});

html += `</div>`;
    } else {
html += `
<div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 0.5rem; padding: 1.5rem; text-align: center;">
    <div style="font-size: 3rem; margin-bottom: 0.5rem;">âœ…</div>
    <div style="font-size: 1.125rem; font-weight: 600; color: #166534;">Tutti i dati sono completi!</div>
    <div style="font-size: 0.875rem; color: #15803d; margin-top: 0.25rem;">Il calcolo sarÃ  accurato al 100%</div>
</div>
`;
    }
    
    html += `</div>`;
    
    return html;
}

/**
 * Mostra popup validazione
 */
window.mostraPopupValidazione = function(validazione, callback) {
    const html = generaHTMLValidazione(validazione);
    const hasErrori = validazione.conErrori > 0;
    const hasWarning = validazione.conWarning > 0;
    
    // Crea modal
    const modal = document.createElement('div');
    modal.id = 'modal-validazione';
    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';
    
    modal.innerHTML = `
<div style="background: white; border-radius: 0.75rem; max-width: 700px; width: 90%; max-height: 85vh; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
    <div style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0; font-size: 1.25rem;">ğŸ“‹ Validazione Preventivo</h3>
        <button onclick="document.getElementById('modal-validazione').remove()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
    </div>
    ${html}
    <div style="padding: 1rem 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 0.75rem;">
        ${hasErrori ? `
            <button onclick="document.getElementById('modal-validazione').remove()" style="padding: 0.625rem 1.25rem; background: #6b7280; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                âŒ Chiudi e correggi
            </button>
        ` : `
            <button onclick="document.getElementById('modal-validazione').remove()" style="padding: 0.625rem 1.25rem; background: #6b7280; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                Annulla
            </button>
            <button id="btn-procedi-calcolo" style="padding: 0.625rem 1.25rem; background: ${hasWarning ? '#f97316' : '#22c55e'}; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                ${hasWarning ? 'âš ï¸ Procedi con warning' : 'âœ… Calcola preventivo'}
            </button>
        `}
    </div>
</div>
    `;
    
    document.body.appendChild(modal);
    
    // Handler bottone procedi
    const btnProcedi = document.getElementById('btn-procedi-calcolo');
    if (btnProcedi && callback) {
btnProcedi.onclick = () => {
    document.getElementById('modal-validazione').remove();
    callback();
};
    }
}

// Esponi funzioni globalmente
window.validaProdotto = validaProdotto;
window.validaProgetto = validaProgetto;
window.mostraPopupValidazione = mostraPopupValidazione;
window.SCHEMA_VALIDAZIONE = SCHEMA_VALIDAZIONE;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… v8.467: FUNZIONE CENTRALIZZATA DETERMINAZIONE TIPO INFISSO
// Questa funzione determina il tipo corretto dell'infisso basandosi su:
// 1. codiceModello (500-514 = scorrevoli)
// 2. ferramenta1 (710-722 = scorrevoli)
// 3. tipoInfissoAssociato (F, PF)
// 4. tipo (F1, F2, PF1, PF2, etc.)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.determinaTipoInfisso = function(infisso, configInfissi = null) {
    const codiceModello = infisso?.codiceModello || '';
    const ferramenta1 = infisso?.ferramenta1 || '';
    const tipoInfissoAssociato = infisso?.tipoInfissoAssociato || '';
    const tipo = infisso?.tipo || '';
    const H_mm = infisso?.BRM_H || infisso?.brm?.H || 0;
    
    // Liste scorrevoli
    const codiciScorrevoli = ["500", "501", "503", "504", "505", "510", "511", "513", "514"];
    const ferramentaScorrevole = ["710", "711", "720", "721", "722"];
    
    let risultato = {
tipoVisualizzato: '',      // Es: "Scorrevole 503", "F1", "PF2", "HST 601"
tipoFinstral: '101',       // Es: "503", "101", "401", "FS601"
isScorrevole: false,
isFinSlide: false,         // ğŸ†• v8.472: Flag FIN-Slide/HST
isPortaFinestra: false,
numAnte: 1
    };
    
    // âœ… v8.468c: USA tipoInfissoAssociato per decidere F vs PF
    // Fallback: H >= 1800mm = porta-finestra
    const isPF = tipoInfissoAssociato === 'PF' || H_mm >= 1800;
    const prefisso = isPF ? 'PF' : 'F';
    risultato.isPortaFinestra = isPF;
    
    // ğŸ†• v8.472: PRIORITÃ€ 0 - FIN-SLIDE (Alzante Scorrevole / HST)
    if (codiceModello && codiceModello.startsWith('FS')) {
const codiceNumerico = codiceModello.replace('FS', '');
risultato.tipoVisualizzato = `HST ${codiceNumerico}`;
risultato.tipoFinstral = codiceModello;  // Mantiene "FS601" per lookup
risultato.isScorrevole = true;
risultato.isFinSlide = true;
risultato.isPortaFinestra = true;
// Numero ante da codice: 600=0fissi, 601/602=1anta, 614/615=2ante
if (['FS600', 'FS621'].includes(codiceModello)) {
    risultato.numAnte = 0;  // Solo fissi
} else if (['FS601', 'FS602'].includes(codiceModello)) {
    risultato.numAnte = 1;
} else {
    risultato.numAnte = 2;  // 610, 611, 614, 615, 616, 617
}
console.log(`ğŸ  determinaTipoInfisso: FIN-Slide "${codiceModello}" â†’ HST ${codiceNumerico}`);
return risultato;
    }
    
    // PRIORITÃ€ 1: Scorrevoli da codiceModello
    if (codiciScorrevoli.includes(codiceModello)) {
risultato.tipoVisualizzato = `Scorrevole ${codiceModello}`;
risultato.tipoFinstral = codiceModello;
risultato.isScorrevole = true;
risultato.isPortaFinestra = true;  // Scorrevoli sono sempre porte
risultato.numAnte = 2;
console.log(`ğŸšª determinaTipoInfisso: codiceModello="${codiceModello}" â†’ Scorrevole`);
return risultato;
    }
    
    // PRIORITÃ€ 2: Scorrevoli da ferramenta
    if (ferramentaScorrevole.some(f => ferramenta1.startsWith(f))) {
const tipoScorr = codiceModello || "503";
risultato.tipoVisualizzato = `Scorrevole ${tipoScorr}`;
risultato.tipoFinstral = tipoScorr;
risultato.isScorrevole = true;
risultato.isPortaFinestra = true;
risultato.numAnte = 2;
console.log(`ğŸšª determinaTipoInfisso: ferramenta1="${ferramenta1}" â†’ Scorrevole ${tipoScorr}`);
return risultato;
    }
    
    // PRIORITÃ€ 3: Usa codiceModello per calcolo prezzo + tipoInfissoAssociato per F/PF
    if (codiceModello && /^\d{3}$/.test(codiceModello)) {
risultato.tipoFinstral = codiceModello;

// Determina numero ante da codiceModello
if (codiceModello === '102') {
    risultato.numAnte = 0;  // Fisso
    risultato.tipoVisualizzato = 'F0 (fisso)';
    risultato.isPortaFinestra = false;
} else if (codiceModello === '101') {
    risultato.numAnte = 1;
    risultato.tipoVisualizzato = `${prefisso}1`;
} else if (codiceModello === '401' || codiceModello === '301') {
    risultato.numAnte = 2;
    risultato.tipoVisualizzato = `${prefisso}2`;
} else if (codiceModello === '420' || codiceModello === '421') {
    risultato.numAnte = 3;
    risultato.tipoVisualizzato = `${prefisso}3`;
} else {
    risultato.numAnte = 1;
    risultato.tipoVisualizzato = `${prefisso}1`;
}

console.log(`ğŸ“Œ determinaTipoInfisso: codiceModello="${codiceModello}", tipoInfissoAssociato="${tipoInfissoAssociato}" â†’ ${risultato.tipoVisualizzato}`);
return risultato;
    }
    
    // PRIORITÃ€ 4: Usa campo tipo se presente
    if (tipo) {
risultato.tipoVisualizzato = tipo;
const numAnte = estraiNumeroAnte(tipo);
risultato.numAnte = numAnte;

// Determina tipoFinstral
if (tipo.toUpperCase().includes('F0') || tipo.toLowerCase().includes('fisso')) {
    risultato.tipoFinstral = '102';
    risultato.numAnte = 0;
} else if (numAnte >= 3) {
    risultato.tipoFinstral = '420';
} else if (numAnte === 2 || isPF) {
    risultato.tipoFinstral = '401';
} else {
    risultato.tipoFinstral = '101';
}
console.log(`ğŸ“‹ determinaTipoInfisso: tipo="${tipo}" â†’ ${risultato.tipoFinstral}`);
return risultato;
    }
    
    // PRIORITÃ€ 5: Solo tipoInfissoAssociato senza altri dati
    risultato.tipoVisualizzato = `${prefisso}1`;
    risultato.tipoFinstral = '101';
    risultato.numAnte = 1;
    console.log(`ğŸ“‹ determinaTipoInfisso: tipoInfissoAssociato="${tipoInfissoAssociato}", H=${H_mm}mm â†’ ${risultato.tipoVisualizzato}`);
    return risultato;
}

// FUNZIONI CALCOLO FINSTRAL
// âœ… v8.46: Funzione helper per cercare prezzo in tabella semplice
window.cercaPrezzoInTabella = function(tabella, larghezza, altezza) {
    if (!tabella) return null;
    
    // Trova colonna: prima colonna dove larghezza <= limite
    let colIdx = tabella.colonneL.length - 1;
    for (let i = 0; i < tabella.colonneL.length; i++) {
if (larghezza <= tabella.colonneL[i]) { 
    colIdx = i; 
    break; 
}
    }
    
    // Trova riga usando logica Finstral
    let rowIdx = 0;
    for (let i = 0; i < tabella.righeA.length; i++) {
if (altezza <= tabella.righeA[i]) { 
    rowIdx = i; 
    break; 
}
rowIdx = i;
    }
    
    if (tabella.prezzi[rowIdx] && tabella.prezzi[rowIdx][colIdx] !== null) {
return { prezzo: tabella.prezzi[rowIdx][colIdx], colIdx, rowIdx };
    }
    return null;
}

window.trovaPrezzoBaseFinstral = function(tipo, larghezza, altezza) {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… v8.46: GESTIONE TIPI COMPOSITI (420, 421, ecc.)
    // Fonte: Listino Finstral EUR 2025/10 - Procedura calcolo prezzo
    // 
    // REGOLA TIPO 420:
    // campo 1 = tipo 101 â†’ prezzo base secondo tabella tipo 101
    // campo 2 = tipo 401 â†’ prezzo base secondo tabella tipo 401
    // prezzo base tipo 420 = somma dei due
    //
    // Proporzioni campi (verificate da conferme d'ordine):
    // - Campo 1 (anta singola): ~33.7% della larghezza totale
    // - Campo 2+3 (montante mobile): ~66.3% della larghezza totale
    // 
    // FATTORE CORREZIONE EUR 2025/10 (variabile per altezza):
    // - H <= 1600: +20.75%
    // - 1600 < H <= 2200: +22%
    // - H > 2200: +27%
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // âœ… v8.462: Fattore variabile basato su TIPO e ALTEZZA
    // Per tipo 102 (fisso): fattore specifico +33.6%
    // Per altri tipi: fattore basato su altezza
    const fattore = FINSTRAL_PREZZI.getFattoreCorrezione ? 
            FINSTRAL_PREZZI.getFattoreCorrezione(altezza, tipo) : 
            (FINSTRAL_PREZZI.fattoreCorrezione || 1.0);
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… v8.466: GESTIONE TIPI SCORREVOLI (500, 501, 503, etc.)
    // Fonte: Listino Finstral EUR 2025/10 - Procedura calcolo prezzo pag.156
    // 
    // REGOLA SCORREVOLI:
    // - tipo 500: tabella 101 (montante mobile)
    // - tipo 501: campo1 (101) + campo2 (102)
    // - tipo 503: campo1 (101) + campo2 (101) - anta apribile + scorrevole
    // - tipo 510: campo1 (101) + campo2 (101)
    // - tipo 511: campo1 (102) + campo2 (101) - fisso + scorrevole
    // - tipo 513: campo1+3 (102) + campo2 (101)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const configScorrevole = FINSTRAL_PREZZI.tipiScorrevoli?.[tipo];
    if (configScorrevole) {
const campi = configScorrevole.campi || ["101"];
const numCampi = campi.length;

// Proporzioni campi - per ora divido equamente
const larghezzaCampo = Math.round(larghezza / numCampi);

let prezzoTotale = 0;
const dettagliCampi = [];

for (let i = 0; i < numCampi; i++) {
    const tipoTabella = campi[i];
    const tabella = FINSTRAL_PREZZI["tipo" + tipoTabella];
    
    if (!tabella) {
        console.warn(`âš ï¸ Tabella tipo${tipoTabella} non trovata per campo ${i+1}`);
        continue;
    }
    
    const risultato = cercaPrezzoInTabella(tabella, larghezzaCampo, altezza);
    if (risultato) {
        prezzoTotale += risultato.prezzo;
        dettagliCampi.push(`Campo${i+1}(tipo${tipoTabella}): L=${larghezzaCampo} â†’ â‚¬${risultato.prezzo}`);
    }
}

if (prezzoTotale > 0) {
    // ğŸ†• v8.478: Usa fattore specifico se definito, altrimenti default 1.236
    // Tipo 500 scorrevole parallela: fattore 1.97 (â‚¬1286/â‚¬653)
    const fattoreScorrevole = configScorrevole.fattorePrezzo || 1.236;
    const prezzoCorretto = Math.round(prezzoTotale * fattoreScorrevole * 100) / 100;
    
    console.log(`ğŸšª tipo${tipo} SCORREVOLE: L=${larghezza}, H=${altezza}`);
    dettagliCampi.forEach(d => console.log(`   ${d}`));
    console.log(`   Base EUR 2025/3: â‚¬${prezzoTotale}`);
    console.log(`   Ã— fattore ${fattoreScorrevole} = â‚¬${prezzoCorretto} (EUR 2025/10)`);
    return prezzoCorretto;
} else {
    console.warn(`âš ï¸ tipo${tipo} SCORREVOLE: impossibile calcolare prezzo`);
    return null;
}
    }
    
    // TIPI COMPOSITI - Calcolo per somma campi
    if (tipo === "420" || tipo === "421") {
// Proporzioni verificate da conferme ordine Finstral
const PROP_CAMPO1 = 0.337;  // Anta singola (tipo 101)
const PROP_CAMPO2 = 0.663;  // Montante mobile (tipo 401)

const L_campo1 = Math.round(larghezza * PROP_CAMPO1);
const L_campo2 = Math.round(larghezza * PROP_CAMPO2);

const tabella101 = FINSTRAL_PREZZI.tipo101;
const tabella401 = FINSTRAL_PREZZI.tipo401;

const ris101 = cercaPrezzoInTabella(tabella101, L_campo1, altezza);
const ris401 = cercaPrezzoInTabella(tabella401, L_campo2, altezza);

if (ris101 && ris401) {
    // Applica fattore correzione EUR 2025/10
    const prezzoBase = ris101.prezzo + ris401.prezzo;
    const prezzoCorretto = Math.round(prezzoBase * fattore * 100) / 100;
    console.log(`ğŸ“Š tipo${tipo} COMPOSITO: L=${larghezza}, H=${altezza}`);
    console.log(`   Campo1 (tipo101): L=${L_campo1} â†’ â‚¬${ris101.prezzo}`);
    console.log(`   Campo2 (tipo401): L=${L_campo2} â†’ â‚¬${ris401.prezzo}`);
    console.log(`   Base EUR 2025/3: â‚¬${prezzoBase}`);
    console.log(`   Ã— fattore ${fattore} = â‚¬${prezzoCorretto} (EUR 2025/10)`);
    return prezzoCorretto;
} else {
    console.warn(`âš ï¸ tipo${tipo}: impossibile calcolare prezzo composito`);
    return null;
}
    }
    
    // TIPO STANDARD - Cerca in tabella diretta
    const tabella = FINSTRAL_PREZZI["tipo" + tipo];
    if (!tabella) {
console.warn(`âš ï¸ Tabella tipo${tipo} non trovata`);
return null;
    }
    
    const risultato = cercaPrezzoInTabella(tabella, larghezza, altezza);
    
    if (risultato) {
// Applica fattore correzione EUR 2025/10
const prezzoCorretto = Math.round(risultato.prezzo * fattore * 100) / 100;
console.log(`ğŸ“Š trovaPrezzoBase tipo${tipo}: L=${larghezza}â†’col[${risultato.colIdx}], H=${altezza}â†’riga[${risultato.rowIdx}]`);
console.log(`   Base EUR 2025/3: â‚¬${risultato.prezzo} Ã— ${fattore} = â‚¬${prezzoCorretto} (EUR 2025/10)`);
return prezzoCorretto;
    }
    return null;
}

window.calcolaPrezzoFinstral = function(config) {
    // ğŸ†• v8.509: Usa BRM con fallback automatico da misure vano
    const brmCalcolato = window.getBRMConFallback(config);
    const larghezza = brmCalcolato.L;
    const altezza = brmCalcolato.H;
    
    // Log se BRM Ã¨ stato calcolato con fallback
    if (brmCalcolato.source !== 'BRM diretto') {
        console.log(`ğŸ“ BRM calcolato con fallback: ${larghezza}Ã—${altezza} (${brmCalcolato.source})`);
    }
    
    const { tipo = "101", telaio = "961", materiale = "pvc", vetro = "standard",
    tipoAnta = "step-line", colorePVC = "01", coloreAlluminio = null } = config;
    
    // âœ… v7.73: DEBUG - Mostra parametri ricevuti
    console.log(`ğŸ”¬ calcolaPrezzoFinstral() riceve: telaio=${telaio}, materiale=${materiale}, tipoAnta=${tipoAnta}`);
    
    const risultato = { config, dettaglio: {}, totale: 0, errore: null };
    
    // Prezzo base da griglia standard
    const prezzoBase = trovaPrezzoBaseFinstral(tipo, larghezza, altezza);
    console.log(`ğŸ”¬ trovaPrezzoBaseFinstral(tipo=${tipo}, L=${larghezza}, H=${altezza}) = ${prezzoBase}`);
    if (prezzoBase === null) {
risultato.errore = "Dimensioni fuori range per tipo " + tipo;
console.warn(`âš ï¸ ERRORE: ${risultato.errore}`);
return risultato;
    }
    risultato.dettaglio.prezzoBase = prezzoBase;
    
    const perimetro = ((larghezza * 2) + (altezza * 2)) / 1000;
    risultato.dettaglio.perimetroM = perimetro;
    
    // âœ… v8.462 FIX: Calcolo PERIMETRO BATTENTI per supplemento profilo anta
    // Il supplemento profilo anta va calcolato sul perimetro delle ANTE, non della finestra!
    // âš ï¸ TIPO 102 (FISSO) NON HA ANTE! â†’ numAnte = 0, nessun supplemento anta
    let numAnteDaTipo = 1;  // Default 1 anta
    if (tipo === "102") {
numAnteDaTipo = 0;  // âœ… FISSO: 0 ante
    } else if (tipo === "401" || tipo === "301") {
numAnteDaTipo = 2;  // 2 ante con montante mobile
    } else if (tipo === "420" || tipo === "421") {
numAnteDaTipo = 3;  // 3 ante (composito)
    }
    
    // Se fisso (0 ante), non calcolare perimetro battenti
    const larghezzaAnta_m = numAnteDaTipo > 0 ? (larghezza / numAnteDaTipo) / 1000 : 0;
    const altezzaAnta_m = altezza / 1000;
    const perimetroSingolaAnta = numAnteDaTipo > 0 ? 2 * (larghezzaAnta_m + altezzaAnta_m) : 0;
    const perimetroBattenti = perimetroSingolaAnta * numAnteDaTipo;
    risultato.dettaglio.perimetroBattentiM = perimetroBattenti;
    risultato.dettaglio.numAnte = numAnteDaTipo;
    
    // âœ… v7.73: Normalizza tipo anta PRIMA di usarlo
    const antaNorm = tipoAnta.toLowerCase().replace(/\s+/g, '-');
    
    // âœ… v8.10: Supplemento telaio CON RIVESTIMENTO ALLUMINIO
    // ğŸ†• v8.505: Usa struttura gruppi colore A/B (pvcA/pvcB/aluA/aluB)
    const isGruppoB_telaio = FINSTRAL_PREZZI.supplementiColorePVC?.gruppoB?.includes(colorePVC);
    const gruppoColore = isGruppoB_telaio ? 'B' : 'A';
    risultato.dettaglio.gruppoColorePVC = gruppoColore;
    
    if (materiale === 'alluminio' && coloreAlluminio) {
        // PVC-ALU: somma supplemento PVC interno + supplemento ALU esterno
        const supplTelaio = FINSTRAL_PREZZI.supplementiTelaio[telaio];
        if (supplTelaio) {
            const keyPvc = isGruppoB_telaio ? 'pvcB' : 'pvcA';
            const keyAlu = isGruppoB_telaio ? 'aluB' : 'aluA';
            // RetrocompatibilitÃ : se non trova pvcA/pvcB, usa pvc/alluminio
            const suppPvc = supplTelaio[keyPvc] ?? supplTelaio.pvc ?? 0;
            const suppAlu = supplTelaio[keyAlu] ?? supplTelaio.alluminio ?? 0;
            risultato.dettaglio.supplementoTelaio = Math.round((suppPvc + suppAlu) * perimetro * 100) / 100;
            console.log(`ğŸ”¬ Telaio ${telaio} gruppo ${gruppoColore}: PVC â‚¬${suppPvc}/ml + ALU â‚¬${suppAlu}/ml Ã— ${perimetro.toFixed(2)}ml = â‚¬${risultato.dettaglio.supplementoTelaio}`);
        } else {
            risultato.dettaglio.supplementoTelaio = 0;
        }
    } else {
        // PVC-PVC: solo supplemento PVC
        const supplTelaio = FINSTRAL_PREZZI.supplementiTelaio[telaio];
        if (supplTelaio) {
            const keyPvc = isGruppoB_telaio ? 'pvcB' : 'pvcA';
            const suppPvc = supplTelaio[keyPvc] ?? supplTelaio.pvc ?? 0;
            risultato.dettaglio.supplementoTelaio = Math.round(suppPvc * perimetro * 100) / 100;
            console.log(`ğŸ”¬ Telaio ${telaio} gruppo ${gruppoColore}: PVC â‚¬${suppPvc}/ml Ã— ${perimetro.toFixed(2)}ml = â‚¬${risultato.dettaglio.supplementoTelaio}`);
        } else {
            risultato.dettaglio.supplementoTelaio = 0;
        }
    }
    
    // âœ… v8.462 FIX: Supplemento PROFILO ANTA su PERIMETRO BATTENTI (non finestra!)
    // âš ï¸ FISSO (tipo 102): NON ha ante, quindi supplementoProfiloAnta = 0
    if (numAnteDaTipo === 0) {
console.log(`ğŸ”¬ Tipo ${tipo} (FISSO): 0 ante â†’ supplementoProfiloAnta = â‚¬0`);
risultato.dettaglio.supplementoProfiloAnta = 0;
risultato.dettaglio.tipoCalcoloAnta = "fisso";
    } else {
// Prima controlla se esiste tabella dimensionale per questo tipo anta
const suppTabellaAnta = getSupplementoAntaDimensionale(antaNorm, altezza, larghezza / numAnteDaTipo);
    if (suppTabellaAnta !== null && suppTabellaAnta > 0) {
// Ante speciali (Cristal, Twin): prezzo â‚¬/pezzo Ã— numAnte
risultato.dettaglio.supplementoProfiloAnta = Math.round(suppTabellaAnta * numAnteDaTipo * 100) / 100;
risultato.dettaglio.tipoCalcoloAnta = "tabella";
console.log(`ğŸ”¬ Profilo ${antaNorm}: TABELLA â‚¬${suppTabellaAnta}/pezzo Ã— ${numAnteDaTipo} ante = â‚¬${risultato.dettaglio.supplementoProfiloAnta}`);
    } else {
// Ante normali: prezzo â‚¬/ml Ã— perimetro battenti
// ğŸ†• v8.505: Usa struttura gruppi colore A/B
const supplProfilo = FINSTRAL_PREZZI.supplementiProfiloAnta?.[antaNorm];
if (supplProfilo) {
    const isNovaLine = antaNorm.includes('nova');
    const keyPvc = isGruppoB_telaio ? 'pvcB' : 'pvcA';
    const keyAlu = isGruppoB_telaio ? 'aluB' : 'aluA';
    
    // RetrocompatibilitÃ : se non trova pvcA/pvcB, usa pvc/alluminio
    let suppPvc = supplProfilo[keyPvc] ?? supplProfilo.pvc ?? 0;
    let suppAlu = 0;
    
    // Nova-line Ã¨ SOLO PVC (ha vetro esterno, no alluminio)
    if (materiale === 'alluminio' && !isNovaLine) {
        suppAlu = supplProfilo[keyAlu] ?? supplProfilo.alluminio ?? 0;
    }
    
    const totaleProf = suppPvc + suppAlu;
    console.log(`ğŸ”¬ Profilo ${antaNorm} gruppo ${gruppoColore}: PVC â‚¬${suppPvc}/ml + ALU â‚¬${suppAlu}/ml Ã— ${perimetroBattenti.toFixed(2)}ml (${numAnteDaTipo} ante)`);
    risultato.dettaglio.supplementoProfiloAnta = Math.round(totaleProf * perimetroBattenti * 100) / 100;
    risultato.dettaglio.tipoCalcoloAnta = "perimetro";
    console.log(`ğŸ”¬ â†’ supplementoProfiloAnta = â‚¬${risultato.dettaglio.supplementoProfiloAnta}`);
} else {
    console.log(`ğŸ”¬ Profilo ${antaNorm}: NON TROVATO in supplementiProfiloAnta`);
    risultato.dettaglio.supplementoProfiloAnta = 0;
}
    }
    }  // âœ… v8.462: Fine blocco else per fisso
    
    // âœ… v7.79 FIX: Supplemento MONTANTE MOBILE per tipo 401 (2 ante)
    // Usa nodo specifico per tipo anta (Nova-line usa NL45, Twin usa C45, ecc.)
    if (tipo === "401") {
const codiceNodo = FINSTRAL_PREZZI.nodiPerTipoAnta?.[antaNorm] || "codice28";
const montanteData = FINSTRAL_PREZZI.supplementiMontante?.[codiceNodo];
console.log(`ğŸ”¬ Montante: tipo anta ${antaNorm} â†’ nodo ${codiceNodo}`);
if (montanteData) {
    // Determina gruppo colore per prezzo montante
    const isGruppoB = FINSTRAL_PREZZI.supplementiColorePVC?.gruppoB?.includes(colorePVC);
    if (materiale === 'alluminio' && coloreAlluminio) {
        // âœ… v7.79: Determina gruppo alluminio (A, B, C, D)
        // C = decorativi legno (Lxx), D = RAL/NCS speciali
        let gruppoAlu = 'aluA';
        const colUpper = coloreAlluminio.toUpperCase();
        if (colUpper.startsWith('L') || colUpper.includes('LEGNO') || colUpper.includes('CASTAGNO') || 
            colUpper.includes('ROVERE') || colUpper.includes('NOCE') || colUpper.includes('DECOR')) {
            gruppoAlu = isGruppoB ? 'aluD' : 'aluC';  // Decorativi legno
        } else if (colUpper.startsWith('RAL') || colUpper.startsWith('NCS') || colUpper.startsWith('DB')) {
            gruppoAlu = 'aluD';  // RAL/NCS speciali
        } else {
            gruppoAlu = isGruppoB ? 'aluB' : 'aluA';  // Standard
        }
        risultato.dettaglio.supplementoMontante = montanteData[gruppoAlu] || montanteData.aluA || 0;
        risultato.dettaglio.gruppoMontante = gruppoAlu;
        console.log(`ğŸ”¬ Montante ${codiceNodo}[${gruppoAlu}] = â‚¬${risultato.dettaglio.supplementoMontante}`);
    } else {
        risultato.dettaglio.supplementoMontante = isGruppoB ? (montanteData.pvcB || 0) : (montanteData.pvcA || 0);
        risultato.dettaglio.gruppoMontante = isGruppoB ? 'pvcB' : 'pvcA';
    }
} else {
    console.warn(`âš ï¸ Nodo ${codiceNodo} non trovato in supplementiMontante`);
    risultato.dettaglio.supplementoMontante = 0;
}
    } else {
risultato.dettaglio.supplementoMontante = 0;
    }
    
    // ğŸ†• v8.505: Supplemento colore PVC ora INTEGRATO in pvcA/pvcB di telaio e anta
    // Non calcolare separatamente per evitare duplicazioni
    risultato.dettaglio.supplementoColorePVC = 0;
    // Il gruppoColorePVC Ã¨ giÃ  stato impostato sopra
    
    // ğŸ†• v8.505: Supplemento colore alluminio ora INTEGRATO in aluA/aluB di telaio e anta
    // Manteniamo solo il costo preparazione per RAL/NCS speciali
    risultato.dettaglio.supplementoColoreAlluminio = 0;
    if (materiale === "alluminio" && coloreAlluminio) {
        const alluminio = FINSTRAL_PREZZI.supplementiColoreAlluminio;
        let costoPrep = 0;
        let gruppoAlu = "1";
        if (alluminio?.gruppo2?.codici?.some(c => coloreAlluminio.toUpperCase().includes(c)) || 
            coloreAlluminio.toUpperCase().startsWith("RAL")) {
            costoPrep = alluminio.gruppo2?.costoPreparazione || 284;
            gruppoAlu = "2";
        } else if (coloreAlluminio.toUpperCase().startsWith("NCS") || coloreAlluminio.toUpperCase().startsWith("DB")) {
            costoPrep = alluminio.gruppo3?.costoPreparazione || 1410;
            gruppoAlu = "3";
        }
        risultato.dettaglio.gruppoColoreAlluminio = gruppoAlu;
        risultato.dettaglio.costoPreparazioneColore = costoPrep;
    } else {
        risultato.dettaglio.costoPreparazioneColore = 0;
    }
    
    // Supplemento vetro
    const superficieVetro = Math.max(0.4, ((larghezza - 100) / 1000) * ((altezza - 100) / 1000));
    risultato.dettaglio.superficieVetroM2 = Math.round(superficieVetro * 100) / 100;
    
    const supplVetro = FINSTRAL_PREZZI.supplementiVetro[vetro] || 0;
    risultato.dettaglio.supplementoVetro = Math.round(supplVetro * superficieVetro * 100) / 100;
    
    // ğŸ†• v8.44: Bancale Interno (se configurato)
    if (config.bancaleTipo && config.bancaleProfondita) {
const lunghezzaBancale = config.bancaleLunghezza || larghezza;
risultato.dettaglio.bancale = {
    tipo: config.bancaleTipo,
    profondita: config.bancaleProfondita,
    lunghezza: lunghezzaBancale,
    prezzo: calcolaPrezzoBancaleInterno(config.bancaleTipo, config.bancaleProfondita, lunghezzaBancale)
};
console.log(`ğŸªŸ Bancale ${config.bancaleTipo}: P=${config.bancaleProfondita}mm L=${lunghezzaBancale}mm â†’ â‚¬${risultato.dettaglio.bancale.prezzo}`);
    }
    
    // ğŸ†• v8.44: Anta Twin - Veneziana/Plissettata (se configurato)
    if (config.antaTwinTipo && (config.antaTwinTipo === 'veneziana' || config.antaTwinTipo === 'plissettata')) {
risultato.dettaglio.antaTwin = {
    tipo: config.antaTwinTipo,
    modello: config.antaTwinModello,  // âš ï¸ Chiave interna (es. "SLIM_TWIN"). Usa getTwinModelDescription() per visualizzare
    colore: config.antaTwinColore,
    comando: config.antaTwinComando || '27',
    prezzo: calcolaPrezzoAntaTwin(config.antaTwinTipo, larghezza, altezza, config.antaTwinComando || '27')
};
console.log(`ğŸšï¸ Anta Twin ${config.antaTwinTipo}: L=${larghezza} H=${altezza} â†’ â‚¬${risultato.dettaglio.antaTwin.prezzo}`);
    }
    
    // ğŸ†• v8.45: Supplemento Ferramenta (se configurato)
    // âœ… v8.466: Supporto ferramenta scorrevole
    if (config.ferramenta1) {
// Prima cerca in FINSTRAL_FERRAMENTA_PREZZI (ferramenta standard)
const ferrData = FINSTRAL_FERRAMENTA_PREZZI?.[config.ferramenta1];
// Poi cerca in supplementiFerramenta (scorrevoli)
const ferrScorrevole = FINSTRAL_PREZZI.supplementiFerramenta?.[config.ferramenta1];

if (ferrScorrevole) {
    risultato.dettaglio.supplementoFerramenta = ferrScorrevole;
    risultato.dettaglio.ferramentaCodice = config.ferramenta1;
    risultato.dettaglio.ferramentaDescrizione = `Scorrevole ${config.ferramenta1}`;
    console.log(`ğŸšª Ferramenta scorrevole ${config.ferramenta1}: â‚¬${ferrScorrevole}`);
} else if (ferrData) {
    risultato.dettaglio.supplementoFerramenta = ferrData.prezzo || 0;
    risultato.dettaglio.ferramentaCodice = config.ferramenta1;
    risultato.dettaglio.ferramentaDescrizione = ferrData.descrizione;
    console.log(`ğŸ”§ Ferramenta ${config.ferramenta1}: â‚¬${risultato.dettaglio.supplementoFerramenta}`);
} else {
    risultato.dettaglio.supplementoFerramenta = 0;
}

// âœ… v8.466: Per tipo 503, aggiungi supplemento ferramenta 430 (anta apribile)
const configScorrevole = FINSTRAL_PREZZI.tipiScorrevoli?.[tipo];
if (configScorrevole?.ferramenta430) {
    const suppl430 = FINSTRAL_PREZZI.supplementiFerramenta?.["430"] || 14.80;
    risultato.dettaglio.supplementoFerramenta430 = suppl430;
    console.log(`ğŸšª Supplemento ferramenta 430 (anta apribile): â‚¬${suppl430}`);
}

// ğŸ†• v8.478: Supplemento ferramenta automatico per tipo 500 (scorrevole parallela)
if (configScorrevole?.supplementoFerramenta && risultato.dettaglio.supplementoFerramenta === 0) {
    risultato.dettaglio.supplementoFerramenta = configScorrevole.supplementoFerramenta;
    risultato.dettaglio.ferramentaCodice = "710";
    risultato.dettaglio.ferramentaDescrizione = "Scorrevole parallela (automatico)";
    console.log(`ğŸšª Supplemento ferramenta automatico tipo ${tipo}: â‚¬${configScorrevole.supplementoFerramenta}`);
}
    } else {
risultato.dettaglio.supplementoFerramenta = 0;
    }
    
    // ğŸ†• v8.45: Supplemento Accessori (se configurato)
    risultato.dettaglio.supplementoAccessori = 0;
    risultato.dettaglio.accessoriDettaglio = [];
    if (config.accessori && Array.isArray(config.accessori)) {
config.accessori.forEach(codAcc => {
    const accData = FINSTRAL_ACCESSORI_PREZZI[codAcc];
    if (accData) {
        const prezzoAcc = accData.prezzo || 0;
        risultato.dettaglio.supplementoAccessori += prezzoAcc;
        risultato.dettaglio.accessoriDettaglio.push({
            codice: codAcc,
            descrizione: accData.descrizione,
            prezzo: prezzoAcc
        });
    }
});
console.log(`ğŸ”© Accessori totale: â‚¬${risultato.dettaglio.supplementoAccessori}`);
    }
    
    // TOTALE (escluso costo preparazione colore che Ã¨ una tantum)
    // âœ… v7.73: Aggiunto supplementoProfiloAnta e supplementoMontante
    // âœ… v8.44: Aggiunto bancale e anta twin
    // âœ… v8.45: Aggiunto ferramenta e accessori
    // âœ… v8.466: Aggiunto supplementoFerramenta430 per tipo 503
    risultato.totale = Math.round((
risultato.dettaglio.prezzoBase +
risultato.dettaglio.supplementoTelaio +
(risultato.dettaglio.supplementoProfiloAnta || 0) +
(risultato.dettaglio.supplementoMontante || 0) +
(risultato.dettaglio.supplementoColorePVC || 0) +
(risultato.dettaglio.supplementoColoreAlluminio || 0) +
risultato.dettaglio.supplementoVetro +
(risultato.dettaglio.bancale?.prezzo || 0) +
(risultato.dettaglio.antaTwin?.prezzo || 0) +
(risultato.dettaglio.supplementoFerramenta || 0) +
(risultato.dettaglio.supplementoFerramenta430 || 0) +  // âœ… v8.466
(risultato.dettaglio.supplementoAccessori || 0)
    ) * 100) / 100;
    
    return risultato;
}

console.log('âœ… FINSTRAL_PREZZI caricato - Listino EUR 2025/3 + Colori + Ferramenta/Cerniere');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.45: DATABASE FERRAMENTA FINSTRAL (da conferme ordine reali)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FINSTRAL_FERRAMENTA_PREZZI = {
    // ANTA/RIBALTA (cerniere a vista - serie 4xx)
    '411': { descrizione: 'Anta/ribalta', prezzo: 11.90, cerniere: 'a-vista' },
    '409': { descrizione: 'Solo anta', prezzo: 9.50, cerniere: 'a-vista' },
    '430': { descrizione: 'Anta con uscita sicurezza', prezzo: 14.20, cerniere: 'a-vista' },
    '453': { descrizione: 'Anta/ribalta porta', prezzo: 13.50, cerniere: 'a-vista' },
    '425': { descrizione: 'Anta doppia', prezzo: 18.90, cerniere: 'a-vista' },
    '475': { descrizione: 'Scorrevole parallelo', prezzo: 45.00, cerniere: null },
    
    // ANTA/RIBALTA (cerniere a scomparsa - serie 2xx)
    '211': { descrizione: 'Anta/ribalta (a scomparsa)', prezzo: 15.20, cerniere: 'a-scomparsa' },
    '209': { descrizione: 'Solo anta (a scomparsa)', prezzo: 12.80, cerniere: 'a-scomparsa' },
    '230': { descrizione: 'Anta sicurezza (a scomparsa)', prezzo: 17.50, cerniere: 'a-scomparsa' },
    '225': { descrizione: 'Anta doppia (a scomparsa)', prezzo: 22.30, cerniere: 'a-scomparsa' },
    
    // FISSO
    '99': { descrizione: 'Elemento fisso', prezzo: 0, cerniere: null },
    
    // SCORREVOLI (serie 7xx)
    '711': { descrizione: 'Scorrevole alzante', prezzo: 85.00, cerniere: null },
    '721': { descrizione: 'Scorrevole traslante', prezzo: 65.00, cerniere: null }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.45: DATABASE ACCESSORI FINSTRAL (da conferme ordine reali)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FINSTRAL_ACCESSORI_PREZZI = {
    '70': { descrizione: 'Protezione antiperforazione', prezzo: 4.50 },
    '454': { descrizione: 'Maniglietta/barra esterna', prezzo: 39.10, note: 'Per porte-finestre' },
    '46-S': { descrizione: 'Profilo aggiuntivo complanare', prezzoMl: 17.18 },
    '21': { descrizione: 'Fori di fissaggio 6mm', prezzo: 0, note: 'Compreso' }
};

console.log('âœ… v8.45: FINSTRAL_FERRAMENTA_PREZZI e FINSTRAL_ACCESSORI_PREZZI caricati');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¦ FINSTRAL CASSONETTI PREZZI - Listino EUR 2025/3 (pag. 141-146)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.FINSTRAL_CASSONETTI_PREZZI = {
    versione: "EUR 2025/3",
    dataAggiornamento: "2025-12-04",
    note: "Per misure intermedie vale la casella piÃ¹ alta. Usb = 1,3 W/mÂ²K",
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PVC CODICE 148 - B fino a 148mm (pag. 141)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    pvc_148: {
codice: "148",
descrizione: "Corpo cassonetto PVC - B fino a 148mm",
maxL: 3860,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740, 2865, 2990, 3115, 3240, 3365, 3490, 3615, 3740, 3860],
righeA: [250, 350, 450, 550, 650],
bianco: [
    [172, 177, 186, 192, 202, 209, 217, 224, 231, 238, 247, 256, 262, 269, 277, 363, 369, 376, 383, 390, 396, 403, 408, 416, 421, 430, 435],
    [179, 187, 197, 207, 214, 221, 231, 240, 248, 258, 266, 275, 282, 292, 300, 385, 395, 403, 409, 418, 428, 434, 442, 450, 462, 470, 477],
    [186, 198, 208, 217, 225, 235, 245, 256, 264, 276, 284, 294, 303, 313, 324, 408, 419, 429, 436, 446, 460, 469, 477, 488, 497, 504, 515],
    [192, 207, 217, 228, 238, 248, 261, 271, 281, 293, 303, 313, 326, 338, 348, 433, 444, 458, 470, 483, 495, 504, 519, 529, 540, 553, 567],
    [202, 215, 225, 237, 250, 263, 275, 285, 297, 311, 324, 335, 348, 359, 372, 461, 473, 485, 497, 507, 522, 532, 543, 556, 569, 583, 595]
],
scuri: [
    [176, 186, 192, 202, 211, 219, 228, 235, 245, 254, 262, 269, 279, 285, 294, 380, 389, 396, 405, 412, 423, 433, 442, 452, 464, 474, 484],
    [186, 197, 207, 215, 224, 233, 244, 254, 262, 271, 280, 289, 300, 310, 316, 405, 412, 423, 432, 440, 447, 460, 467, 475, 484, 491, 499],
    [192, 207, 215, 225, 237, 247, 260, 269, 279, 289, 301, 311, 323, 333, 342, 429, 437, 450, 463, 473, 483, 491, 500, 509, 520, 528, 537],
    [202, 215, 225, 238, 250, 262, 275, 284, 295, 310, 319, 332, 343, 356, 369, 456, 470, 482, 491, 501, 511, 524, 533, 543, 554, 567, 577],
    [213, 224, 237, 250, 263, 276, 286, 301, 313, 327, 340, 355, 367, 380, 393, 483, 496, 504, 520, 532, 545, 560, 573, 590, 601, 617, 628]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PVC CODICE 148B - B da 335 a 600mm (pag. 142)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    pvc_148B: {
codice: "148B",
descrizione: "Corpo cassonetto PVC - B 335-600mm (due profili accoppiati)",
maxL: 3860,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740, 2865, 2990, 3115, 3240, 3365, 3490, 3615, 3740, 3860],
righeA: [250, 350, 450, 550, 650],
bianco: [
    [179, 186, 197, 205, 214, 224, 231, 240, 248, 259, 266, 276, 284, 293, 301, 389, 395, 405, 411, 420, 430, 436, 445, 456, 464, 473, 482],
    [186, 197, 206, 215, 226, 235, 245, 256, 266, 276, 284, 295, 306, 316, 326, 409, 420, 432, 440, 447, 460, 467, 475, 484, 491, 499, 506],
    [192, 206, 217, 226, 237, 248, 261, 272, 281, 293, 302, 315, 327, 340, 354, 434, 446, 460, 472, 484, 496, 506, 520, 530, 542, 554, 568],
    [200, 214, 226, 237, 250, 263, 275, 285, 299, 312, 324, 338, 350, 363, 376, 458, 469, 487, 499, 511, 526, 538, 552, 567, 579, 595, 609],
    [208, 224, 235, 248, 263, 276, 289, 309, 323, 338, 354, 368, 382, 396, 409, 485, 500, 513, 526, 537, 550, 564, 577, 590, 600, 614, 625]
],
scuri: [
    [186, 197, 207, 217, 226, 237, 247, 259, 269, 277, 286, 297, 309, 317, 329, 416, 423, 434, 442, 450, 462, 470, 477, 487, 495, 501, 509],
    [192, 206, 217, 228, 240, 251, 263, 275, 284, 295, 309, 317, 330, 341, 354, 437, 450, 465, 475, 485, 495, 502, 511, 523, 530, 539, 550],
    [205, 215, 228, 240, 253, 264, 277, 289, 301, 315, 327, 342, 358, 372, 387, 467, 480, 502, 517, 529, 542, 556, 570, 586, 599, 614, 627],
    [213, 225, 238, 251, 266, 279, 293, 315, 332, 346, 363, 379, 394, 408, 425, 490, 503, 519, 530, 543, 558, 572, 588, 600, 615, 627, 639],
    [220, 233, 250, 264, 279, 293, 309, 324, 339, 354, 368, 383, 402, 417, 433, 509, 529, 545, 562, 575, 593, 608, 622, 635, 652, 667, 682]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PVC CODICE 300 - B fino a 300mm (pag. 143)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    pvc_300: {
codice: "300",
descrizione: "Corpo cassonetto PVC - B fino a 300mm",
maxL: 3860,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740, 2865, 2990, 3115, 3240, 3365, 3490, 3615, 3740, 3860],
righeA: [250, 350, 450, 550, 650],
bianco: [
    [189, 202, 213, 224, 233, 244, 254, 264, 276, 284, 295, 306, 316, 329, 339, 423, 434, 442, 458, 470, 483, 495, 504, 519, 529, 540, 553],
    [202, 214, 225, 235, 248, 261, 272, 282, 294, 306, 316, 330, 341, 354, 366, 450, 465, 475, 488, 499, 510, 524, 535, 546, 560, 572, 586],
    [213, 225, 237, 250, 263, 276, 286, 300, 313, 327, 340, 354, 367, 379, 391, 482, 491, 503, 519, 530, 543, 558, 572, 588, 600, 615, 627],
    [221, 235, 250, 263, 277, 292, 302, 317, 333, 345, 363, 376, 389, 403, 417, 504, 520, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668],
    [232, 247, 263, 277, 292, 309, 323, 338, 354, 368, 382, 396, 409, 428, 440, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668, 683, 698]
],
scuri: [
    [205, 215, 228, 240, 251, 264, 277, 286, 300, 313, 326, 339, 349, 364, 376, 465, 475, 488, 500, 513, 527, 539, 553, 568, 583, 596, 612],
    [215, 228, 241, 254, 269, 281, 294, 309, 323, 335, 348, 364, 376, 390, 403, 491, 503, 519, 530, 543, 558, 572, 588, 600, 615, 627, 639],
    [226, 240, 254, 271, 282, 299, 313, 329, 342, 358, 372, 387, 402, 416, 429, 520, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668, 683],
    [238, 253, 271, 284, 300, 315, 332, 346, 366, 379, 394, 408, 425, 437, 458, 546, 565, 578, 595, 612, 625, 638, 654, 669, 685, 699, 714],
    [250, 266, 282, 299, 316, 333, 348, 368, 383, 402, 417, 433, 448, 470, 485, 575, 594, 613, 626, 639, 655, 672, 686, 700, 716, 731, 747]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PVC CODICE 300B - B da 335 a 600mm (pag. 144)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    pvc_300B: {
codice: "300B",
descrizione: "Corpo cassonetto PVC - B 335-600mm (due profili accoppiati)",
maxL: 3860,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240, 2365, 2490, 2615, 2740, 2865, 2990, 3115, 3240, 3365, 3490, 3615, 3740, 3860],
righeA: [250, 350, 450, 550, 650],
bianco: [
    [189, 202, 213, 224, 233, 244, 254, 264, 276, 284, 295, 306, 316, 329, 339, 423, 434, 442, 458, 470, 483, 495, 504, 519, 529, 540, 553],
    [202, 214, 225, 235, 248, 261, 272, 282, 294, 306, 316, 330, 341, 354, 366, 450, 465, 475, 488, 499, 510, 524, 535, 546, 560, 572, 586],
    [213, 225, 237, 250, 263, 276, 286, 300, 313, 327, 340, 354, 367, 379, 391, 482, 491, 503, 519, 530, 543, 558, 572, 588, 600, 615, 627],
    [221, 235, 250, 263, 277, 292, 302, 317, 333, 345, 363, 376, 389, 403, 417, 504, 520, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668],
    [232, 247, 263, 277, 292, 309, 323, 338, 354, 368, 382, 396, 409, 428, 440, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668, 683, 698]
],
scuri: [
    [205, 215, 228, 240, 251, 264, 277, 286, 300, 313, 326, 339, 349, 364, 376, 465, 475, 488, 500, 513, 527, 539, 553, 568, 583, 596, 612],
    [215, 228, 241, 254, 269, 281, 294, 309, 323, 335, 348, 364, 376, 390, 403, 491, 503, 519, 530, 543, 558, 572, 588, 600, 615, 627, 639],
    [226, 240, 254, 271, 282, 299, 313, 329, 342, 358, 372, 387, 402, 416, 429, 520, 532, 546, 564, 577, 594, 609, 624, 637, 653, 668, 683],
    [238, 253, 271, 284, 300, 315, 332, 346, 366, 379, 394, 408, 425, 437, 458, 546, 565, 578, 595, 612, 625, 638, 654, 669, 685, 699, 714],
    [250, 266, 282, 299, 316, 333, 348, 368, 383, 402, 417, 433, 448, 470, 485, 575, 594, 613, 626, 639, 655, 672, 686, 700, 716, 731, 747]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEGNO CODICE 9-48 - B fino a 150mm (pag. 145)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    legno_948: {
codice: "9-48",
descrizione: "Corpo cassonetto Legno - B fino a 150mm",
maxL: 2240,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240],
righeA: [250, 350, 450, 550, 650],
gruppo1: [
    [244, 261, 279, 297, 312, 330, 345, 361, 376, 392, 407, 421, 436, 449],
    [279, 297, 318, 336, 354, 375, 393, 411, 427, 445, 462, 479, 496, 511],
    [318, 339, 363, 384, 405, 427, 449, 469, 489, 511, 531, 551, 572, 591],
    [354, 378, 405, 430, 454, 479, 502, 527, 550, 575, 599, 622, 646, 668],
    [390, 418, 448, 477, 504, 533, 560, 588, 615, 642, 670, 696, 723, 749]
],
gruppo23: [
    [368, 394, 421, 449, 471, 497, 520, 544, 566, 590, 613, 634, 656, 677],
    [421, 449, 479, 506, 533, 565, 592, 619, 644, 672, 697, 722, 749, 771],
    [479, 511, 547, 579, 610, 644, 677, 707, 737, 770, 800, 830, 861, 889],
    [533, 569, 610, 648, 684, 722, 756, 794, 829, 866, 901, 936, 973, 1006],
    [588, 629, 675, 718, 759, 803, 844, 886, 927, 967, 1008, 1048, 1089, 1127]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEGNO CODICE 9-48B - B da 335 a 600mm (pag. 146)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    legno_948B: {
codice: "9-48B",
descrizione: "Corpo cassonetto Legno - B 335-600mm (due profili accoppiati)",
maxL: 2240,
colonneL: [615, 740, 865, 990, 1115, 1240, 1365, 1490, 1615, 1740, 1865, 1990, 2115, 2240],
righeA: [250, 350, 450, 550, 650],
gruppo1: [
    [283, 305, 328, 352, 372, 394, 415, 435, 457, 477, 498, 517, 538, 556],
    [328, 352, 378, 403, 425, 451, 474, 497, 520, 543, 566, 588, 611, 632],
    [378, 405, 435, 463, 491, 520, 548, 575, 602, 631, 659, 685, 713, 739],
    [425, 457, 491, 524, 555, 588, 619, 652, 683, 716, 748, 778, 810, 840],
    [474, 510, 550, 588, 623, 660, 695, 732, 767, 804, 840, 874, 910, 944]
],
gruppo23: [
    [427, 460, 495, 531, 561, 594, 625, 656, 688, 719, 750, 778, 809, 837],
    [495, 531, 570, 607, 641, 680, 714, 748, 783, 818, 852, 885, 920, 951],
    [570, 610, 655, 697, 739, 783, 825, 866, 907, 950, 991, 1031, 1073, 1111],
    [641, 688, 739, 789, 836, 886, 933, 981, 1029, 1078, 1126, 1172, 1220, 1265],
    [714, 768, 827, 885, 939, 995, 1048, 1103, 1156, 1211, 1264, 1316, 1370, 1421]
]
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SUPPLEMENTO ISOLAMENTO TERMICO (pag. 140)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    isolamento: {
"40830": { spessore: "25mm", prezzo: 63.1, dimensioni: "1000x790mm", usbRisultante: 0.87 },
"40831": { spessore: "13mm", prezzo: 47.4, dimensioni: "1000x790mm", usbRisultante: 0.87 },
// âœ… v8.11: Alias per codici OpenPorte
"posaclima": { spessore: "25mm", prezzo: 63.1, dimensioni: "1000x790mm", usbRisultante: 0.87 },  // Alias per 40830
"posaclima25": { spessore: "25mm", prezzo: 63.1, dimensioni: "1000x790mm", usbRisultante: 0.87 },
"posaclima13": { spessore: "13mm", prezzo: 47.4, dimensioni: "1000x790mm", usbRisultante: 0.87 }
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COLORI PVC E LEGNO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    coloriPVC: {
bianco: ["01 extraliscio", "42 bianco goffrato", "45 bianco satinato", "07 bianco perla goffrato", "27 bianco perla satinato"],
scuri: ["06 grigio", "46 grigio seta", "13 decoro legno castagno", "19 decoro legno rovere", "55 decoro legno noce chiaro"]
    },
    coloriLegno: {
gruppo1: ["1X01 abete naturale", "1X03 abete sbiancato bianco", "1X05 abete sbiancato", "1X06 abete grigio beige", "1X07 abete marrone", "1X08 abete bianco perla"],
gruppo2: ["2X01 rovere naturale", "2X02 rovere oleato naturale"],
gruppo3: ["3X02 rovere grigio luce", "3X03 rovere grigio sabbia", "3X04 rovere grigio quarzo", "3X05 rovere grigio carbone", "3X06 rovere marrone scuro", "3X07 rovere bianco a poro aperto", "3X08 rovere bianco perla a poro aperto"]
    }
};

console.log('âœ… FINSTRAL_CASSONETTI_PREZZI caricato - Listino EUR 2025/3 (pag. 141-146)');

// âœ… v8.11: Funzione per determinare gruppo colore cassonetto da codice
// Ignora gruppoColoreCass e usa il codice colore effettivo
window.determinaGruppoColoreCassonetto = function(coloreCass) {
    if (!coloreCass) return 'bianco'; // Default
    
    // Estrai codice numerico dal colore (es. "27" da "27 - Bianco perla")
    const match = coloreCass.match(/^(\d{2})/);
    if (!match) return 'bianco';
    
    const codice = match[1];
    
    // Codici bianco (dal listino Finstral pag. 141)
    const codiciBianco = ['01', '07', '27', '42', '45'];
    // Codici scuri (dal listino Finstral pag. 141)  
    const codiciScuri = ['06', '13', '19', '46', '55'];
    
    if (codiciBianco.includes(codice)) {
console.log(`ğŸ“¦ Colore cassonetto "${coloreCass}" â†’ BIANCO (codice ${codice})`);
return 'bianco';
    } else if (codiciScuri.includes(codice)) {
console.log(`ğŸ“¦ Colore cassonetto "${coloreCass}" â†’ SCURI (codice ${codice})`);
return 'scuri';
    } else {
// Fallback: cerca parole chiave nel nome
const lower = coloreCass.toLowerCase();
if (lower.includes('bianco') || lower.includes('perla') || lower.includes('satinato')) {
    return 'bianco';
} else if (lower.includes('grigio') || lower.includes('decoro') || lower.includes('legno') || lower.includes('castagno') || lower.includes('rovere')) {
    return 'scuri';
}
return 'bianco'; // Default conservativo
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ v8.09: DATABASE CODICI FINSTRAL (codiceModello + ferramenta)
// Fonte: OpenPorte v5.52 - FINSTRAL-CODICI-OPENPORTE.md
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FINSTRAL_CODICI = {
    // CODICI MODELLO (struttura finestra)
    modelli: {
// 1 Campo
"101": { descrizione: "1 campo - anta", campi: 1, ante: 1 },
"102": { descrizione: "1 campo - fisso", campi: 1, ante: 0 },
// 2 Campi Orizzontali
"201": { descrizione: "2 ante (SX + DX)", campi: 2, ante: 2 },
"202": { descrizione: "Anta SX + fisso DX", campi: 2, ante: 1 },
"203": { descrizione: "Fisso SX + anta DX", campi: 2, ante: 1 },
"204": { descrizione: "2 fissi", campi: 2, ante: 0 },
// 2 Campi Verticali
"205": { descrizione: "2 ante verticali", campi: 2, ante: 2 },
"206": { descrizione: "Anta basso + fisso alto", campi: 2, ante: 1 },
"207": { descrizione: "Fisso basso + anta alto", campi: 2, ante: 1 },
"208": { descrizione: "2 fissi verticali", campi: 2, ante: 0 },
// 3 Campi
"301": { descrizione: "3 ante (SX + centro + DX)", campi: 3, ante: 3 },
"302": { descrizione: "Anta + fisso + anta", campi: 3, ante: 2 },
"303": { descrizione: "Fisso + anta + fisso", campi: 3, ante: 1 },
"304": { descrizione: "3 fissi", campi: 3, ante: 0 },
"321": { descrizione: "Fisso SX + anta centro + anta DX", campi: 3, ante: 2 },
"322": { descrizione: "Anta SX + anta centro + fisso DX", campi: 3, ante: 2 },
// 4 Campi
"316": { descrizione: "4 ante", campi: 4, ante: 4 },
"317": { descrizione: "4 fissi", campi: 4, ante: 0 },
// Con Montante Mobile
"401": { descrizione: "2 ante con montante mobile", campi: 2, ante: 2, montante: true },
"402": { descrizione: "Fisso basso + 2 ante montante alto", campi: 3, ante: 2, montante: true },
"403": { descrizione: "2 ante montante basso + fisso alto", campi: 3, ante: 2, montante: true },
"414": { descrizione: "Fisso SX + anta montante DX", campi: 2, ante: 1, montante: true },
"415": { descrizione: "Anta montante SX + fisso DX", campi: 2, ante: 1, montante: true },
"420": { descrizione: "Anta SX + anta montante DX", campi: 2, ante: 2, montante: true },
"421": { descrizione: "Anta montante SX + anta DX", campi: 2, ante: 2, montante: true },
"424": { descrizione: "3 ante con montante", campi: 3, ante: 3, montante: true },
// Bilico
"450": { descrizione: "Anta a bilico singola", campi: 1, ante: 1, bilico: true },
"451": { descrizione: "Bilico + fisso DX", campi: 2, ante: 1, bilico: true },
"452": { descrizione: "Fisso SX + bilico", campi: 2, ante: 1, bilico: true },
// Scorrevole
"500": { descrizione: "Scorrevole parallela", campi: 1, ante: 1, scorrevole: true },
"501": { descrizione: "Scorrevole parallela SX", campi: 1, ante: 1, scorrevole: true },
"510": { descrizione: "2 scorrevoli parallele", campi: 2, ante: 2, scorrevole: true },
"511": { descrizione: "Scorrevole parallela DX", campi: 1, ante: 1, scorrevole: true }
    },
    
    // CODICI FERRAMENTA
    ferramenta: {
// Anta/Ribalta
"411": { descrizione: "Anta/ribalta", cerniere: "a-vista" },
"211": { descrizione: "Anta/ribalta", cerniere: "a-scomparsa" },
"409": { descrizione: "Ribalta primaria", cerniere: "a-vista" },
"209": { descrizione: "Ribalta primaria", cerniere: "a-scomparsa" },
// Solo Anta
"430": { descrizione: "Anta interno", cerniere: "a-vista" },
"230": { descrizione: "Anta interno", cerniere: "a-scomparsa" },
"453": { descrizione: "Anta esterno", cerniere: "a-vista" },
// Solo Ribalta
"432": { descrizione: "Ribalta maniglia laterale", cerniere: null },
"232": { descrizione: "Ribalta", cerniere: "a-scomparsa" },
"431": { descrizione: "Sopraluce maniglia superiore", cerniere: null },
"433": { descrizione: "Sopraluce comando leva", cerniere: null },
"434": { descrizione: "Sopraluce arganello", cerniere: null },
"436": { descrizione: "Sopraluce motorizzato", cerniere: null },
// Con Montante
"425": { descrizione: "Anta + comando leva", cerniere: "a-vista" },
"225": { descrizione: "Anta + comando leva", cerniere: "a-scomparsa" },
"B411": { descrizione: "Anta/ribalta + montante alto", cerniere: "a-vista" },
"B211": { descrizione: "Anta/ribalta + montante", cerniere: "a-scomparsa" },
// Porta con Serratura
"475": { descrizione: "Anta/ribalta + serratura", cerniere: "a-vista" },
"275": { descrizione: "Anta/ribalta + serratura", cerniere: "a-scomparsa" },
"473": { descrizione: "Anta + serratura interno", cerniere: "a-vista" },
"471": { descrizione: "Anta + serratura esterno", cerniere: "a-vista" },
// Scorrevoli
"710": { descrizione: "Scorrevole parallela a ribalta", cerniere: null },
"711": { descrizione: "Scorrevole + serratura", cerniere: null },
"720": { descrizione: "Scorrevole parallela", cerniere: null },
"721": { descrizione: "Scorrevole + serratura", cerniere: null }
    },
    
    // LATI APERTURA
    lati: {
"-1": "Sinistra (SX)",
"-2": "Destra (DX)"
    },
    
    // ESECUZIONI SICUREZZA
    esecuzioni: {
"0": "Standard",
"3": "Perimetrale + angolare",
"4": "Perimetrale"
    },
    
    // Funzioni helper
    getModello: function(codice) {
return this.modelli[codice] || { descrizione: `Codice ${codice}`, campi: 1, ante: 1 };
    },
    
    getFerramenta: function(codice) {
return this.ferramenta[codice] || { descrizione: `Ferramenta ${codice}`, cerniere: null };
    },
    
    getLato: function(codice) {
return this.lati[codice] || codice;
    },
    
    getEsecuzione: function(codice) {
return this.esecuzioni[codice] || 'Standard';
    },
    
    // Decodifica completa infisso
    decodificaInfisso: function(infisso) {
const modello = this.getModello(infisso.codiceModello);
const ferramenta = this.getFerramenta(infisso.ferramenta1);
const lato = this.getLato(infisso.lato1);
const esecuzione = this.getEsecuzione(infisso.esecuzione1);

return {
    codiceModello: infisso.codiceModello,
    descrizioneModello: modello.descrizione,
    campi: modello.campi,
    ante: modello.ante,
    montante: modello.montante || false,
    bilico: modello.bilico || false,
    scorrevole: modello.scorrevole || false,
    ferramenta: infisso.ferramenta1,
    descrizioneFerramenti: ferramenta.descrizione,
    cerniere: ferramenta.cerniere,
    lato: lato,
    esecuzione: esecuzione
};
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v8.505: FUNZIONE HELPER PER GRUPPO COLORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getGruppoColoreFinstral(colorePVC) {
    const gruppoB = ["46", "06", "13", "19", "55", "36"];
    return gruppoB.includes(colorePVC) ? 'B' : 'A';
}

if (typeof window !== 'undefined') {
    window.getGruppoColoreFinstral = getGruppoColoreFinstral;
}

console.log('âœ… FINSTRAL_PREZZI v8.509 caricato (BRM fallback + Twin helpers + fix tipo 101)');
